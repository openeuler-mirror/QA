![avatar](../images/openEuler.png)

版权所有 © 2020  openEuler社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述 | 作者      |
| ---------- | ----------- | -------- | --------- |
| 2022/02/14 | 初稿        | 新增     | xing-love |

 关键词：编译器 

 

摘要：报告主要描述版本测试情况，并根据收集的测试数据，对当前版本的质量做出分析和评价。 

 

缩略语清单：

| 缩略语 | 英文全名                   | 中文解释           |
| ------ | -------------------------- | ------------------ |
| HPC    | High Performance Computing | 高性能计算         |
| LLVM   | Low Level Virtual Machine  | LLVM编译器         |
| DFX    | Design for X               | 非功能性属性的设计 |

# 1     特性概述

BiSheng（毕昇）编译器是一款高性能编译器，兼容主流C/C++语言标准，包括C++11/14/17标准支持，兼容主流Fortran语言标准，包括Fortran2003/2008标准支持，满足HPC场景诉求；集成OpenMP线程库；支持ARM8.5安全特性BTI ；支持ARM8.5安全特性PAC ;支持Autotuner自动迭代调优。

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称              | 测试起始时间 | 测试结束时间 |
| --------------------- | ------------ | ------------ |
| BiSheng Test Round 1  | 2021/12/01   | 2021/12/08   |
| BiSheng  Test Round 2 | 2021/12/15   | 2021/12/20   |
| BiSheng  Test Round 3 | 2021/12/23   | 2021/12/26   |
| BiSheng  Test Round 4 | 2021/12/26   | 2021/12/28   |

描述特性测试的硬件环境信息

| 硬件型号           | 硬件配置信息      | 备注             | 操作系统                                                     |
| ------------------ | ----------------- | ---------------- | ------------------------------------------------------------ |
| TaiShan 200 2280型 | 鲲鹏920 ARM64芯片 | 小端模式，硬浮点 | Ubuntu18.04, Ubuntu20.04,openEuler release 20.03 LTS SPx,openEuler release 21.09,openEuler release 21.03,CentOS 7.6,UOS20,麒麟V10 |



# 3     测试结论概述

## 3.1   测试整体结论

BiSheng编译器版本共新增需求 5个，需求100%测试覆盖。总共开展2+2轮测试，总工执行用例100667个，发现问题51个，累计执行率达到100%，在全量功能基础上，完成了兼容性测试，可靠性测试，安全测试，性能测试，代码一致性测试，CodeDB测试，选项测试，资料测试。上述测试发现的主要问题都得到了修正，回归测试结果正常，当前遗留5个问题，遗留DI值为5，相关问题已有影响分析和修复计划。

BiSheng编译器支持Fortran 2003语言标准和Fortran 2008大部分语言标准，其中BiSheng Fortran编译器目前能够跑通HPC领域主流workload，功能和性能达标，但语言场景组合复杂，语法的全面支持上还存在已知遗留问题。BiSheng C/C++编译器整体功能完善，毕昇编译器做了进一步性能优化增强，在极端场景下可用性受限制，包括编译时间变长和异常报错，毕昇编译器性能优化都有开关控制，用户可以根据不同场景需求选择开启和关闭。综上所述，毕昇编译器整体质量稳定。

# 4    版本详细测试结论

## 4.1      代码/模块/接口测试结论

代码相关静态检查告警已全部清零。

 

## 4.2      特性测试结论

### 4.2.1     继承特性质量评价

| Feature                                                      | 商用化风险等级 | 应用说明及关键约束假设依赖 | 关键遗留事项如缺陷等 | 测试整体覆盖情况 | 主要风险 |
| ------------------------------------------------------------ | -------------- | -------------------------- | -------------------- | ---------------- | -------- |
| BiSheng兼容主流C/C++语言标准，C++11/14/17标准支持，满足HPC场景诉求 | 绿灯           | 无                         | NA                   | 全面覆盖         | 无       |
| 集成OpenMP线程库                                             | 绿灯           | 无                         | NA                   | 全面覆盖         | 无       |
| C/C++支持   OpenMP4.0/5.0库                                  | 绿灯           | 无                         | NA                   | 全面覆盖         | 无       |
| BiSheng支持ARM8.5安全特性BTI                                 | 绿灯           | 无                         | NA                   | 全面覆盖         | 无       |
| BiSheng支持ARM8.5安全特性PAC                                 | 绿灯           | 无                         | NA                   | 全面覆盖         | 无       |
| Autotuner自动迭代调优实现                                    | 绿灯           | 无                         | NA                   | 全面覆盖         | 无       |

 

### 4.2.2     新需求质量评价

| Feature                                 | 特性质量评估 | 应用说明及关键约束假设依赖                                   | 测试整体覆盖情况                          | 主要风险                                                     |
| --------------------------------------- | ------------ | ------------------------------------------------------------ | ----------------------------------------- | ------------------------------------------------------------ |
| 通过关键优化技术提升性能                | 绿灯         | 高性能特性依赖鲲鹏硬件平台                                   | 业界通用benchmark                         |                                                              |
| 支持Fortran语言前端兼容性特性           | 黄灯         | BiSheng编译器支持Fortran 2003语言标准和Fortran 2008大部分语言标准，Fortran编译器目前能够跑通HPC领域主流   workload，功能和性能达标，但语言特性组合复杂，语法的全面支持上还存在已知遗留问题。 | 新增需求全面覆盖                          | 用户使用编译器暂时不支持的语言特性时会失败，比如 co-array特性。 |
| 通过关键优化技术实现HPC典型应用性能提升 | 绿灯         | 性能特性依赖鲲鹏硬件平台                                     | 针对HPC典型应用开展性能评测，达标         |                                                              |
| 支持Fortran语言多线程并行编程技术       | 黄灯         | 当前版本支持   OpenMP   4.0/4.5（C/C++）的关键特性           | 新增需求全面覆盖                          | 用户使用编译器暂时不支持的语言特性时会失败。比如：device相关的语句，declare reduction |
| 支持精度调优选项控制                    | 绿灯         | 精度特性依赖鲲鹏硬件平台                                     | 针对HPC典型应用（气象）开展精度评测，达标 |                                                              |



## 4.3      产品质量属性目标（DFx）测试结论

| **序号** | **领域**        | **质量等级** | **产品质量评价说明**                                         |
| -------- | --------------- | ------------ | ------------------------------------------------------------ |
| 1        | 性能            | 绿灯         | 业界通用benchmark性能目标相比GCC9.3 提升25%，实际测试25%，达成 ； HPC 典型应用性能 相比GCC9.3 提升10%，实际测试11.5%，达成；   HPC 气象领域典型应用精度性能目标，达成。 |
| 2        | 可靠性          | 黄灯         | 完成了超规格测试，并发压力和代码生成Fuzz测试（语法合规，单次100万），整体质量稳定，部分偏僻场景下编译器出现Core Dump和运行不一致。 |
| 3        | 安全性          | 绿灯         | BiSheng编译器属于离线编译工具，完成了各类安全测试，本版本的发布件不含有病毒，无已知安全漏洞，无安全问题遗留，满足网络安全要求。 |
| 4        | 兼容性   (生态) | 黄灯         | BiSheng编译器支持Fortran 2003语言标准和Fortran   2008大部分语言标准，毕昇Fortran编译器基于社区Classic   Flang开发，这个版本增加了异步IO等语法特性的支持。当前版本能够满足HPC大部分workload使用，对于确定性范围内代码质量可控，语法的全面支持上存在已知遗留问题和转需求问题。 |
| 5        | 兼容性(环境)    | 绿灯         | 对用户手册中声明支持的操作系统开展了测试，功能正常，整体质量稳定 |
| 6        | 易用性          | 绿灯         | 1）BiSheng编译器基于LLVM架构，整体报错检查能力比gcc严格，客户从gcc切换到LLVM的过程中可能会有更多告警或报错（用户代码不合格）；毕昇编译器性能优化会增强部分场景（比如循环）的编译时长，毕昇编译器给用户提供了优化选项开关，用户可以根据不同场景需求进行开启和关闭；部分偏僻场景下编译器出现Segmentation   Fault/Core Dump可能无法指导用户定位，但整体报错和告警能力比GCC更优。所以评估为绿灯。 |
| 7        | 资料            | 绿灯         | 版本提供的用户指南、Autotuner特性指南完成测试，资料完整，且没有歧义。 |



## 4.4   约束说明

- 内存：8GB以上
- 操作系统：openEuler21.03、openEuler 20.03 (LTS)、CentOS 7.6、Ubuntu 18.04、Ubuntu 20、麒麟V10、UOS 20
- 架构：AArch64
- GCC版本：4.8.5以上
- glibc版本：2.17以上
- libatomic版本：1.2及以上

## 4.5   遗留问题分析

### 4.5.1 遗留问题影响以及规避措施

| 问题单号 | 问题描述                                                     | 问题级别 | 问题影响和规避措施                                 | 当前状态 |
| -------- | ------------------------------------------------------------ | -------- | -------------------------------------------------- | -------- |
| 1        | 子字符串指针传参给字符串指针不支持导致编译报错               | 次要     | 暂无好的规避方案，修改用户代码                     |          |
| 2        | fuzz用例中O2与O0运行时结果不一致                             | 次要     | 使用开源流水线可以规避                             |          |
| 3        | module间Type bound procedures重载场景编译错误                | 次要     | 暂无好的规避方案，需要修改用户代码                 |          |
| 4        | 构建codedb应用 velvet 编译报错，找不到type name 'Bytef'      | 次要     | 随机问题，1%概率出现，再编译一遍大概率可以编译通过 |          |
| 5        | gfortran移植用例dtio_31.f03，大概率是当编译fortran派生类型IO时引起错误 | 次要     | 随机错误，再一次编译大概率问题消失                 |          |

### 4.5.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 5        | 0    | 0    | 5    | 0      |
| 百分比 | 100%     | 0    | 0    | 100% | 0      |

# 5     测试执行

## 5.1   测试执行统计数据

| 版本                 | 总测试用例数 | 实际测试的用例数 | Passed项 | Failed项 | 发现问题数 |
| -------------------- | ------------ | ---------------- | -------- | -------- | ---------- |
| BiSheng Test Round 1 | 100562       | 100562           | 100508   | 54       | 44         |
| BiSheng Test Round 2 | 100562       | 100562           | 100555   | 7        | 7          |
| BiSheng Test Round 3 | 100667       | 100667           | 100660   | 7        | 0          |
| BiSheng Test Round 4 | 100667       | 100667           | 100660   | 7        | 0          |

其中： 

Passed 用例执行成功

Failed 用例全部或部分执行结果未通过或者测试执行过程中遇到其它与本用例无关的失效事件



## 5.2   后续测试建议

后续测试需要关注点(可选)，无

# 6     附件

*此处可粘贴各类专项测试数据或报告*



 



 

 
