![openEuler ico](../../images/openEuler.png)

版权所有 © 2024 openEuler社区  
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA
4.0”)的约束。为了方便用户理解，您可以通过访问<https://creativecommons.org/licenses/by-sa/4.0/>了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA
4.0的完整协议内容您可以访问如下网址获取：<https://creativecommons.org/licenses/by-sa/4.0/legalcode>。

 修订记录

| 日期 | 修订版本     | 修改描述  | 作者 |
| ---- | ----------- | -------- | ---- |
| 2024-11-14 |  1.0.0    |  初稿     | 林孟孟 |

关键词：【云原生】KubeOS支持集群参数统一配置、镜像定制化和静态完整性保护dm-verity

摘要：新增集群参数统一配置、镜像定制化和静态完整性保护dm-verity

缩略语清单：
| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |

# 特性描述
<!-- 主要介绍特性实现的背景、功能以及作用 -->

背景：24年建行All in云原生，联合openEuler KubeOS团队打造金融级云原生操作系统，构筑金融行业首个金融级系统安全、云原生统一运维，性能与资源利用率4倍+提升的云原生操作系统，逐步改善现有云底座维护敏捷性不足、云底座服务响应慢等业务痛点问题，加速全栈创新提升竞争力，引领行业创新。在KubeOS统一运维框架的统一运维管理能力和镜像制作能力的基础上：
- 1、增强云原生统一配置能力，支持节点containerd、kubelet等集群组件参数统一配置能力，解决集群配置操作复杂，节点配置不统一的问题，减少人工配置操作(天级->小时级），降低集群维护难度；
- 2、提供支持定制化功能的镜像制作工具协助建行打造自主可控的云原生OS，减少对腾讯云的依赖。
- 3、增加启动完整性校验，确保基础设施可信不可变，系统每次启动均符合预期，避免特权攻击篡改篡改系统设置（rootkit攻击），为金融应用提供安全的运行环境，构建金融级安全的云原生操作系统

## 需求清单
|no|feature|status|sig|owner|发布方式|涉及软件包列表|
|:----|:---|:---|:--|:----|:----|:----|
|[IB42M9](https://gitee.com/openeuler/release-management/issues/IB42M9?from=project-issue)| 【openEuler 24.03-LTS-SP1 】KubeOS支持集群参数统一配置、镜像定制化和静态完整性保护 | Developing | SIG-CloudNative-KubeOS | @liyuanr | ISO  | KubeOS |



# 特性分层策略
## 总体测试策略
<!-- 主要描述特性的整体测试策略，主要开展哪些测试(接口/功能/场景/专项) -->

- 测试目标：覆盖新增接口（配置文件）测试、开启dm-verity的升级回退、制作的镜像进行继承用例测试
- 时间进度：待评估
- 风险评估：镜像制作的配置文件待测配置项繁多，镜像操作复杂，时间进度存在一定风险
- 重点事项：重点保证新增功能和继承功能正常
- 争议事项：NA

## 特性测试约束
<!-- 主要描述特性测试的约束条件 -->

- 仅支持UEFI引导的x86及arm架构
- 新老KubeOS之间兼容
- 不支持跨R版本升级等继承约束条件
- dm-verity只支持虚拟机场景，不支持物理机
- dm-verity升级镜像与普通虚拟机镜像之间不兼容
- 统一下发的配置文件路径及内容由用户自己保证，不对内容做校验



## 接口测试
<!-- 主要描述接口级测试策略及测试设计思路 -->

| 接口描述 | 设计思路 | 测试重点 | 备注 |
| ------- | ------- | ------- | ---- |
| 参数统一配置 | 验证参数范围内正常生效，非法配置和不配置时，接口返回符合预期  | 进行升级/回退/配置的节点/etc/security/limits.conf的配置  | NA  |
| 参数统一配置 | 验证参数范围内正常生效，非法配置和不配置时，接口返回符合预期  | 进行升级/回退/配置的节点kubelet的配置  | NA  |
| 参数统一配置 | 验证参数范围内正常生效，非法配置和不配置时，接口返回符合预期  | 进行升级/回退/配置的节点containerd的配置  | NA  |
| 镜像制作 | 验证参数范围内正常生效，非法配置和不配置时，接口返回符合预期  | kbimg命令行参数&kbimg配置文件参数 | NA  |

## 功能测试
<!-- 主要描述特性提供的功能的测试策略及测试思路 -->

| 功能描述 |  测试重点 | 备注 |
| ------- |  ------- | ---- |
| 未开启dm-verity的镜像进行升级回退测试（虚拟机场景） |  继承用例覆盖全量 |      |
| pxe引导安装物理机环境，进行升级回退（物理机场景） |   磁盘镜像+容器镜像两个升级场景    |      |
| pxe引导安装虚拟机环境，进行升级回退（虚拟机场景） |   磁盘镜像+容器镜像两个升级场景    |      |
| 开启dm-verity+安全启动（需要去bios界面加载证书、开启安全启动），进行升级回退测试（虚拟机场景） |   升级回退验证&不支持下发grub参数配置，下发后直接忽略；不支持磁盘镜像升级，只支持容器镜像升级   |      |



## 场景测试
<!-- 主要描述对特性使用的主要场景的测试策略及测试思路 -->

功能测试已覆盖


## 专项测试
<!-- 主要描述其他专项测试,如安全测试 稳定性测试 性能测试 兼容性测试等 -->

| 专项测试类型 | 专项测试描述 | 测试预期结果 | 备注 |
| ----------- | ----------- | ----------- | ---- |
| 可靠性测试 | 升级过程中的掉电等异常 | 升级流程未有变更 |      |
| 可靠性测试 | 镜像制作命令并发执行 | 正常报错退出后检查残留文件的清理、对再次制作无影响 |      |
| 可靠性测试 | 制作过程中掉电/kill进程 | 关注残留文件权限，残留文件对再次制作镜像无影响 |      |
| 兼容性测试 | 未开启dm-verity校验和开启校验的之间的升级不兼容 | 不兼容 |      |
| 兼容性测试 | 多节点，部分开启dm-verity校验，部分未开启 | 需要用户自己控制去下发对应的升级镜像 |      |
| 安全测试 | 检查kbimg命令、配置文件的权限&检查kbimg命令执行生成的脚本、镜像文件、秘钥等文件的权限 | 符合权限标准 |      |
| 资料测试 | 配置文件下发的文件格式、配置参数格式 | 镜像制作的参数及配置文件参数配置格式有详细说明 |      |

# 特性测试环境描述
<!-- 主要描述执行测试的硬件信息 -->
不涉及特殊硬件

| 硬件型号 | 硬件配置信息 | 备注 |
| -------- | ------------ | ---- |

# 特性测试执行策略

## 测试计划
<!-- 测试执行策略主要描述该轮次执行的分层策略中的测试项 -->

| Stange name   | Begin time | End time   | Days | 测试执行策略                   | 备注   |
| :------------ | :--------- | :--------- | ---- | ----------------------------- | ------ |
|     round3-round4      |  2024/11/28        |2024/12/12      |     12|                    全量测试           |        |
|     round5        |   2024/12/12         |  2024/12/19         |7      |   回归测试+长稳测试                            |        |

# 入口标准  
1.特性满足质量标准，达成需求设计要求目标

# 出口标准  
1.策略规划的测试活动涉及测试用例100%执行完毕  
2.版本无严重问题遗留，其他问题有规避措施

# 附件
