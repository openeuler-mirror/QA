![openEuler ico](../../images/openEuler.png)

版权所有 © 2024 openEuler社区  
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA
4.0”)的约束。为了方便用户理解，您可以通过访问<https://creativecommons.org/licenses/by-sa/4.0/>了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA
4.0的完整协议内容您可以访问如下网址获取：<https://creativecommons.org/licenses/by-sa/4.0/legalcode>。

 修订记录

| 日期 | 修订版本     | 修改描述  | 作者 |
| ---- | ----------- | -------- | ---- |
| 2024-11-16 |  1.0.0    |  初稿     | 林孟孟 |

关键词：可信根框架 

摘要：支持一套可信根框架，南向支持多种可信根（当前主要考虑TPM+virtCCA），北向提供统一度量接口，实现完整性保护软件栈对硬件的0感知。

缩略语清单：
| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |

# 特性描述
<!-- 主要介绍特性实现的背景、功能以及作用 -->

**背景：**
鲲鹏使能virtCCA机密计算方案后，需要对机密虚机内的应用程序使能IMA度量。由于virtCCA本身具备可信根和远程证明机制，因此IMA支持对接virtCCA可降低部署成本，避免由于再次对接TPM造成额外的部署成本。

由于内核社区的原生IMA代码仅支持了TPM可信根，并采用硬编码的函数逻辑实现，因此扩展virtCCA的可信根需要修改适配相应流程，不符合代码开闭原则。

对于完整性度量软件栈（当前主要考虑IMA），openEuler亟需支持一套可信根框架，南向支持多种可信根（当前主要考虑TPM+virtCCA），北向提供统一度量接口，实现完整性保护软件栈对硬件的0感知。

## 需求清单
|no|feature|status|sig|owner|发布方式|涉及软件包列表|
|:----|:---|:---|:--|:----|:----|:----|
|[IB3ZDN](https://gitee.com/openeuler/release-management/issues/IB3ZDN?from=project-issue)| 【openEuler 24.03-LTS-SP1 】IMA度量通过异构可信根框架使能TPM/virtCCA信任根 | Developing | sig-security-facility | 	@zhujianwei001 | ISO  | IMA |



# 特性分层策略
## 总体测试策略
<!-- 主要描述特性的整体测试策略，主要开展哪些测试(接口/功能/场景/专项) -->

- 测试目标：验证接口ima_rot启动参数，验证可信根TPM、virtCCA、ima度量，以及新增启动参数的各种组合的场景测试。
- 时间进度：待评估
- 风险评估：NA
- 重点事项：同测试目标
- 争议事项：NA

## 特性测试约束
<!-- 主要描述特性测试的约束条件 -->

NA

## 接口测试
<!-- 主要描述接口级测试策略及测试设计思路 -->

| 接口描述 | 设计思路 | 测试重点 | 备注 |
| ------- | ------- | ------- | ---- |
| ima_rot启动参数测试 | 增加启动参数ima_rot=tpm、virtcca、aaaa * 等   | 验证系统启动成功 | NA  |

## 功能测试
<!-- 主要描述特性提供的功能的测试策略及测试思路 -->

| 功能描述 | 设计思路 | 测试重点 | 备注 |
| ------- | ------- | ------- | ---- |
| 机器仅支持TPM可信根，ima_rot=tpm，度量测试 | 导入IMA策略，度量所有的EXEC和MMAP系统调用访问的文件  |   执行任意命令，检查度量日志 ；根据tpm寄存器初始值，及模板哈希值计算当前tpm寄存器值预期值  |      |
| 机器仅支持virtCCA可信根，ima_rot=virtcca，ima度量测试 |  调用检查工具，计算当前度量日志的扩展值|   调用virtCCA的远程证明工具查询度量寄存器的值   | |
| 机器支持TPM可信根和virtCCA可信根，ima度量测试（打桩） | 优先使用tpm可信根（ima_rot=tpm，ima_rot=virtcca），进行ima度量后  |   查看度量结果与tpm寄存器值   |   |


## 场景测试
<!-- 主要描述对特性使用的主要场景的测试策略及测试思路 -->

参考功能场景

## 专项测试
<!-- 主要描述其他专项测试,如安全测试 稳定性测试 性能测试 兼容性测试等 -->

NA

# 特性测试环境描述
<!-- 主要描述执行测试的硬件信息 -->
不涉及特殊硬件

| 硬件型号 | 硬件配置信息 | 备注 |
| -------- | ------------ | ---- |

# 特性测试执行策略

## 测试计划
<!-- 测试执行策略主要描述该轮次执行的分层策略中的测试项 -->

| Stange name   | Begin time | End time   | Days | 测试执行策略                   | 备注   |
| :------------ | :--------- | :--------- | ---- | ----------------------------- | ------ |
|     round2       |  2024/11/22        |2024/11/28       |     12|                    全量测试           |        |
|     round3-round4         |   2024/11/28         |  2024/12/12         |7      |   回归测试+长稳测试                            |        |

# 入口标准  
1.特性满足质量标准，达成需求设计要求目标

# 出口标准  
1.策略规划的测试活动涉及测试用例100%执行完毕  
2.版本无严重问题遗留，其他问题有规避措施

# 附件
