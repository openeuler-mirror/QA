![openEuler ico](../../images/openEuler.png)

版权所有 © 2024 openEuler社区  
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA
4.0”)的约束。为了方便用户理解，您可以通过访问<https://creativecommons.org/licenses/by-sa/4.0/>了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA
4.0的完整协议内容您可以访问如下网址获取：<https://creativecommons.org/licenses/by-sa/4.0/legalcode>。

 修订记录

| 日期 | 修订版本     | 修改描述  | 作者 |
| ---- | ----------- | -------- | ---- |
| 2024-11-15 |  1.0.0    |  初稿     | 林孟孟 |

关键词：【AI】Gala-anteater支持AI训练场景的慢节点/慢卡检测

摘要：单节点时间维度的异常检测，输出慢节点/慢卡；组内多节点/多卡空间维度对比，输出慢节点/慢卡

缩略语清单：
| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |

# 特性描述
<!-- 主要介绍特性实现的背景、功能以及作用 -->

背景：AI集群在训练过程中性能劣化场景主要是复杂故障场景，导致性能劣化的原因很多且复杂，劣化感知以及快速初因定界。当前集群尚无在线劣化感知，初因定界以及根因诊断功能。本特性通过AI训练场景的慢节点/慢卡，能实时在线观测系统关键KPI，并基于模型和数据驱动的算法对观测数据进行实时分析，给出慢节点位置，便于系统自愈或者运维人员修复问题。

## 需求清单
|no|feature|status|sig|owner|发布方式|涉及软件包列表|
|:----|:---|:---|:--|:----|:----|:----|
|[IB42MO](https://gitee.com/openeuler/release-management/issues/IB42MO?from=project-issue)| 【openEuler 24.03-LTS-SP1 】AI集群慢节点快速发现 Add Fail-slow Detection | Developing | desktop sig | @webankto | ISO  | Gala |



# 特性分层策略
## 总体测试策略
<!-- 主要描述特性的整体测试策略，主要开展哪些测试(接口/功能/场景/专项) -->

- 测试目标：重点测试组内多节点/多卡空间维度对比，输出慢节点/慢卡的检测精度，从功能，场景，可靠可用性，资料等维度给出评估。
- 时间进度：待评估
- 风险评估：NA
- 重点事项：重点测试组内多节点/多卡空间维度对比，输出慢节点/慢卡的检测精度；
- 争议事项：NA

## 特性测试约束
<!-- 主要描述特性测试的约束条件 -->

本特性需配套npu设备

## 接口测试
<!-- 主要描述接口级测试策略及测试设计思路 -->


不涉及

## 功能测试
<!-- 主要描述特性提供的功能的测试策略及测试思路 -->

| 功能描述 | 设计思路 | 测试重点 | 备注 |
| ------- | ------- | ------- | ---- |
| 单组8卡随机注入一次故障检测慢卡 |  配置单组npu8卡环境，在其中某一卡上注入故障 |  观察采集指标是否有明显变化的指标，验证算法是否检测出注入故障的慢卡，查看上报到kafka中的日志与算法定位日志是否一致   |      |
| 单组8卡随机注入两次故障检测慢卡 |  配置单组npu8卡环境，在其中某两张卡注入故障 |   观察采集指标是否有明显变化的指标，验证算法是否检测出注入故障的慢卡，查看上报到kafka中的日志与算法定位日志是否一致    |    |
| 两组单组4卡随机注入一次故障检测慢卡 |  配置两组npu卡环境，在其中某组单卡上注入故障 |  观察采集指标是否有明显变化的指标，验证算法是否检测出注入故障的慢卡，查看上报到kafka中的日志与算法定位日志是否一致    |    |
| 两组单组4卡随机注入两次故障检测慢卡 |  配置两组npu卡环境 ，注入两起故障检测(两组各选择一张卡注入故障，不建议单组注入两起故障，因为单组4张卡，注入两起故障2vs2，不符合少数异常原则)|   观察采集指标是否有明显变化的指标，验证算法是否检测出注入故障的慢卡，查看上报到kafka中的日志与算法定位日志是否一致    |    |
| 新增配置文件的配置项及权限 |  配置npu卡分组情况|   权限644 | |


## 场景测试
<!-- 主要描述对特性使用的主要场景的测试策略及测试思路 -->

参考功能场景

## 专项测试
<!-- 主要描述其他专项测试,如安全测试 稳定性测试 性能测试 兼容性测试等 -->

| 专项测试类型 | 专项测试描述 | 测试预期结果 | 备注 |
| ----------- | ----------- | ----------- | ---- |
| 场景测试 | 慢节点检测精度/检测时间验证 | 慢节点检测精度>80%，检测时间<10分钟 |      |
| 可靠性测试 | 长稳运行验证模型正常运行，训练日志正常打印step时延，检测算法启动，3天以上长时间运行(无故障注入)，统计kafka中的异常检测结果，误报率0.5%以下 | 无异常报错及退出，统计误报率在0.5%以下 |  时间3天以上    |


# 特性测试环境描述
<!-- 主要描述执行测试的硬件信息 -->
不涉及特殊硬件

| 硬件型号 | 硬件配置信息 | 备注 |
| ----------- | ----------- | ----------- |
| Atlas d801 | NPU卡，num>=4 |  |

# 特性测试执行策略

## 测试计划
<!-- 测试执行策略主要描述该轮次执行的分层策略中的测试项 -->

| Stange name   | Begin time | End time   | Days | 测试执行策略                   | 备注   |
| :------------ | :--------- | :--------- | ---- | ----------------------------- | ------ |
|     round2       |  2024/11/22        |2024/11/28       |     12|                    全量测试           |        |
|     round3-round4         |   2024/11/28         |  2024/12/12         |7      |   回归测试+长稳测试                            |        |

# 入口标准  
1.特性满足质量标准，达成需求设计要求目标

# 出口标准  
1.策略规划的测试活动涉及测试用例100%执行完毕  
2.版本无严重问题遗留，其他问题有规避措施

# 附件
