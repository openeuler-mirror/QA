![openEuler ico](../../images/openEuler.png)

版权所有 © 2024 openEuler社区  
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA
4.0”)的约束。为了方便用户理解，您可以通过访问<https://creativecommons.org/licenses/by-sa/4.0/>了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA
4.0的完整协议内容您可以访问如下网址获取：<https://creativecommons.org/licenses/by-sa/4.0/legalcode>。

 修订记录

| 日期 | 修订版本     | 修改描述  | 作者 |
| ---- | ----------- | -------- | ---- |
| 2024-11-13 |  1.0.0    |  初稿     | 林孟孟 |

关键词：syscare 补丁顺序保存与恢复

摘要：24.09版本继承22.03-LTS-SP4版本syscare功能，提供一键式集成用户态和内核态热补丁编译以及补丁生命周期管理工具，并新增补丁顺序保存与恢复功能。

缩略语清单：
| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |

# 特性描述
<!-- 主要介绍特性实现的背景、功能以及作用 -->
背景：24.03-LTS-SP1版本继承24.09版本syscare功能，提供一键式集成用户态和内核态热补丁编译以及补丁生命周期管理工具，并新增补丁顺序保存与恢复功能。

## 需求清单
|no|feature|status|sig|owner|发布方式|涉及软件包列表|
|:----|:---|:---|:--|:----|:----|:----|
|[IB431M](https://gitee.com/openeuler/release-management/issues/IB431M?from=project-issue)| 【openEuler 24.03-LTS-SP1 】syscare热补丁特性增强 | Developing | sig-ops | @luanjianhai | ISO  | syscare |



# 特性分层策略
## 总体测试策略
<!-- 主要描述特性的整体测试策略，主要开展哪些测试(接口/功能/场景/专项) -->

- 测试目标：新增特性主要功能：补丁顺序保存与恢复；继承特性主要包括热补丁制作与热补丁管理。在覆盖已有测试点的基础上，重点测试此次新增的补丁顺序保存与恢复，检查补丁在多种状态之间的状态变化，以及多个补丁并发状态切换之后，补丁是否可以正确的保存与恢复状态，进行长稳测试和资料测试。
- 时间进度：待评估
- 风险评估：NA
- 重点事项：验证补丁顺序保存与恢复功能；
- 争议事项：NA

## 特性测试约束
<!-- 主要描述特性测试的约束条件 -->

- 当前仅支持64位系统；
- 当前仅支持ELF格式的热修复，暂不支持解释型语言；
- 当前仅支持gcc / g++编译器；
- 编译器需要支持-gdwarf -ffunction-sections -fdata-sections参数；
- 仅支持DWARF格式的调试信息，且不支持g3等级；
- 不支持修改全局变量；
- 暂不支持交叉编译；
- 暂不支持汇编修改；
- 暂不支持新增外部符号（动态库依赖）；
- 暂不支持对同一个二进制打多个补丁；
- 暂不支持补丁文件名相同，Bind为Local并且Type为STT_FUNC或STT_OBJECT完全相同的符号修改： 存在同名文件，并且局部变量和函数名称完全一致，实现可能不一致；
- 暂不支持C & C++ 混合编译；
- 暂不支持C++ exception修改；
- 暂不支持group section: -g3编译选项，特定编译优化选项，特定gcc plugin等；
- 暂不支持新增ifunc: __attribute__((ifunc("foo")))；
- 暂不支持新增TLS变量: __thread int foo；
- 暂不支持编译开启LTO选项。

## 接口测试
<!-- 主要描述接口级测试策略及测试设计思路 -->

| 接口描述 | 设计思路 | 测试重点 | 备注 |
| ------- | ------- | ------- | ---- |
| NA | NA  | NA  | NA  |

## 功能测试
<!-- 主要描述特性提供的功能的测试策略及测试思路 -->

| 功能描述 | 设计思路 | 测试重点 | 备注 |
| ------- | ------- | ------- | ---- |
| 覆盖接口正常，异常测试。包括syscare build热补丁制作接口， syscare管理热补丁接口 |   |      |      |
| 覆盖用户态，内核态的热补丁制作测试。内核态覆盖内核和内核模块，用户态主要覆盖redis，nginx，openvswicth，openssl，glibc，重点测试补丁依赖，累积补丁等场景。 |   |      |
| 覆盖补丁顺序保存与恢复功能测试，重点测试多个补丁，多次变更状态，多次重启等场景。 |   |      |


## 场景测试
<!-- 主要描述对特性使用的主要场景的测试策略及测试思路 -->

参考功能场景

## 专项测试
<!-- 主要描述其他专项测试,如安全测试 稳定性测试 性能测试 兼容性测试等 -->

| 专项测试类型 | 专项测试描述 | 测试预期结果 | 备注 |
| ----------- | ----------- | ----------- | ---- |
| 可靠性测试 | 热补丁制作和管理操作期间，构造CPU，内存高负载 | 补丁制作正常 |      |
| 可靠性测试 | 构造虚拟机异常重启，异常断电 | 环境恢复后不影响正常操作 |      |
| 可靠性测试 | 构造热补丁制作和管理期间，临时补丁文件和补丁状态等关键文件被篡改 |补丁制作失败，但不影响后续补丁生成  |      |
| 并发长稳测试 | 并发起syscare-build，并穿插syscare一系列管理操作 | 补丁制作和补丁管理操作成功 |      |
| 并发长稳测试 | 在syscare的管理流程并发执行背景下，不断执行kill syscare操作，不定期重启syscare服务 | 补丁制作和补丁管理操作成功 |      |
| 并发长稳测试 | 制作多个补丁，随机并发执行修改补丁状态操作，验证新增功能长稳可靠性 |  补丁制作和补丁管理操作成功|      |

# 特性测试环境描述
<!-- 主要描述执行测试的硬件信息 -->
不涉及特殊硬件

| 硬件型号 | 硬件配置信息 | 备注 |
| -------- | ------------ | ---- |

# 特性测试执行策略

## 测试计划
<!-- 测试执行策略主要描述该轮次执行的分层策略中的测试项 -->

| Stange name   | Begin time | End time   | Days | 测试执行策略                   | 备注   |
| :------------ | :--------- | :--------- | ---- | ----------------------------- | ------ |
|     round2       |  2024/11/22        |2024/11/28       |     12|                    全量测试           |        |
|     round3-round4         |   2024/11/28         |  2024/12/12         |7      |   回归测试+长稳测试                            |        |

# 入口标准  
1.特性满足质量标准，达成需求设计要求目标

# 出口标准  
1.策略规划的测试活动涉及测试用例100%执行完毕  
2.版本无严重问题遗留，其他问题有规避措施

# 附件
