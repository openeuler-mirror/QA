![openEuler ico](../../images/openEuler.png)

版权所有 © 2021  openEuler社区
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问[*https://creativecommons.org/licenses/by-sa/4.0/*](https://creativecommons.org/licenses/by-sa/4.0/) 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：[*https://creativecommons.org/licenses/by-sa/4.0/legalcode*](https://creativecommons.org/licenses/by-sa/4.0/legalcode)。

修订记录

| 日期       | 修订版本 | 修改章节 | 修改描述   |
| ---------- | -------- | -------- | ---------- |
| 2023/10/25 | 1.1.0    | 初始     | yangshicheng/baijing |

**关键词：**

统一构建平台 工程构建 镜像定制     

**摘要：**

文本主要描述统一构建 930版本的整体测试过程，详细叙述测试覆盖情况，并通过问题分析对版本整体质量进行评估和总结。按照测试策略，对EulerMaker项目下的新需求、继承特性接口、web页面功能、文档以及易用性进行测试。


# 1   概述

EulerMaker主要有两大模块功能，分别为工程构建、镜像定制；
本文主要描述统一构建 930版本的总体测试活动，按照社区开发模式进行运作，结合社区release-manager团队制定的版本计划规划相应的测试计划及活动。测试报告覆盖新需求测试执行情况和评估，并结合各类专项测试活动和版本问题单总体情况进行整体的说明和质量评估。

## 1.1 新增特性功能
在继承现有功能的基础上，本次新增七大特性，其中包括：web界面等优化使能易用性提升、spec传统os + yaml定制层、异构测试机接入、安全加固、EulerMaker支持热补丁、支持本地命令行实现本地软件包构建、基于分层定制和镜像定制生成树莓派镜像。

### DFX增强：web界面等优化使能易用性提升
- 指定单包增量构建
- 通过yaml创建project
- 通过yaml实现镜像定制创建
- 镜像定制新增场景化侧边导航
- 支持rebuild二次提醒用户
- 支持在软件包下载页面查看归属job
- 支持构建历史表格展示全量/增量构建任务的repo发布结果
- 支持增量构建结果刷新至Build Result中

### spec传统os + yaml定制层
- 支持基于架构的分层定制
- spec传统OS 生成定制层

### 异构测试机接入，实现异构软件包构建
- 异构测试机接入

### 安全加固：后台运行环境镜像归一化
- （python等）debian更新为debian最新版本镜像
- Nginx更新为最新版本镜像（Alpine）
- centOS停维的系统镜像，替换为openEuler

### EulerMaker支持热补丁
- 支持本地复现历史热补丁制作热补丁任务环境（EBS新增命令字）
- 支持推送热补丁发布件至dayilybuild
- 支持获取热补丁制作任务进展/结果，同时刷新至对应issue及PR评论区（CI）
- 支持发布热补丁产物（CI）
- 支持发布热补丁产物（EBS）
- 支持消费热补丁制作任务（CI）
- 支持创建热补丁制作任务（EBS新增API）
- 支持获取rpm包对应的历史job_id(EBS新增命令字)
- 支持创建热补丁制作工程 （CI）
- 支持创建热补丁制作工程（CI）

### 支持本地命令行实现本地软件包构建
-  支持本地命令行实现本地软件包构建

### 基于分层定制和镜像定制生成树莓派镜像
- 支持镜像定制生成树莓派镜像
- 建设嵌入式层，通过分层定制构建软件包

## 1.2 继承特性
继承特性包含web页面触发单包构建/全量/增量构建、ccb命令行触发单包/全量/增量构建；web端生成版本镜像/定制镜像，对应镜像产物验证。

# 2   测试版本说明

1.本节描述被测对象的版本信息和测试的时间及测试转测轮次，详细的版本信息和测试时间如下表：

| 版本名称             | 测试起始时间   | 测试结束时间  |  备注      |
| ------------------- | ------------ | ------------ |  ------    |
| EulerMaker 930 RC1  | 2023-08-24  | 2023-08-30   |  部分继承特性测试、部分EulerMaker支持热补丁/web界面优化需求测试   |
| EulerMaker 930 RC2  | 2023-08-31  | 2023-09-06   |  部分继承特性测试、部分EulerMaker支持热补丁/web界面优化需求测试、本地构建软件包测试、spec传统os + yaml定制层测试   |
| EulerMaker 930 RC3  | 2023-09-07  | 2023-09-18   |  异构测试机接入测试、生成树莓派镜像测试、 剩余EulerMaker支持热补丁需求测试   |
| EulerMaker 930 RC4  | 2022-09-19  | 2023-10-09   |  安全加固测试、剩余web界面优化需求测试        |
| EulerMaker 930 RC5  | 2022-10-10  | 2023-10-26   |  全量SIT验证       |
| EulerMaker 930 RC6  | 2022-10-27  | 2023-11-3    |  回归测试          |

## 2.1 软件环境
测试的软件环境如下：

| 测试机                            | 配置信息                                                                          |个数| 备注                      |
| ----------------------------------- | ------------------------------------------------------------------------------------- | ------------------------- | ------------------------- |
| kubeoperator部署机| ARCH: arm<br />CPU: 8P<br />MEM: 15G<br />DISK_OS: 500G|1台|虚拟机|
| kubeoperator部署机| ARCH: x86<br />CPU: 8P<br />MEM: 15G<br />DISK_OS: 500G|1台|虚拟机|
| server01| ARCH: arm<br />CPU: 48P<br />MEM: 188G<br />DISK_OS: 500G|1台|虚拟机|
| server02| ARCH: arm<br />CPU: 48P<br />MEM: 96G<br />DISK_OS: 500G|1台|虚拟机|
| server03| ARCH: arm<br />CPU: 48P<br />MEM: 96G<br />DISK_OS: 500G|1台|虚拟机|
| test-at1| ARCH: arm<br />CPU: 48P<br />MEM: 96G<br />DISK_OS: 200G|1台|虚拟机|
| test-at2| ARCH: arm<br />CPU: 48P<br />MEM: 96G<br />DISK_OS: 500G|1台|虚拟机|
| test-at3| ARCH: arm<br />CPU: 48P<br />MEM: 96G<br />DISK_OS: 500G|1台|虚拟机|
| test-at4| ARCH: arm<br />CPU: 48P<br />MEM: 188G<br />DISK_OS: 200G|1台|虚拟机|
| test-xt3| ARCH: x86<br />CPU: 48P<br />MEM: 96G<br />DISK_OS: 200G|1台|虚拟机|
| test-xt4| ARCH: x86<br />CPU: 48P<br />MEM: 96G<br />DISK_OS: 200G|1台|虚拟机|
| test-xt5| ARCH: x86<br />CPU: 48P<br />MEM: 96G<br />DISK_OS: 200G|1台|虚拟机|
| test-xt6| ARCH: x86<br />CPU: 48P<br />MEM: 128G<br />DISK_OS: 500G|1台|虚拟机|

## 2.2 硬件环境
|  硬件型号         |     硬件配置信息         |  备注  |
| ---------------- | ------------------- | ------ |
|     树莓派4B卡    |  CPU:Cortex-A72 * 4 内存：8GB 存储设备：SanDisk Ultra 128GB micro SD    |    默认测试环境，数量1     |

# 3   版本概要测试结论

 统一构建 930版本整体测试按照release-manager团队的计划，共完成了四轮模块测试 + 一轮全量测试 + 两轮回归测试，共执行用例410条；930版本按照测试策略完成了全量功能验证，所有测试任务均按计划完成。本版本计划交付SR需求7个，实际交付7个，交付率100%；其中计划交付AR需求24个，实际交付23个，交付率95.83%；其中，计划交付AR需求 建设嵌入式层，通过分层定制构建软件包并未转测，因此，除该AR需求未测试外，其余的发布需求均验证通过。

​ 统一构建 930版本共发现问题101个，有效问题96个，回归测试遗留结果正常。版本整体特性质量基本可用，存在部分遗留问题。




# 4   版本详细测试结论

版本详细测试内容包括：

1、web界面等优化使能易用性提升、spec传统os + yaml定制层、异构测试机接入、安全加固、EulerMaker支持热补丁、支持本地命令行实现本地软件包构建、基于分层定制和镜像定制生成树莓派镜像。


## 4.1   特性测试结论

### 4.1.1   新需求评价

建议以表格的形式汇总新特性测试执行情况及遗留问题单情况的评估,给出特性质量评估结论。

| **序号** | **特性名称**                                         | **测试覆盖情况**                                             | **约束依赖说明** | **遗留问题单** | **质量评估**               | **备注<img width=50/>**                                      |
| -------- | ---------------------------------------------------- | ------------------------------------------------------------ | ---------------- | -------------- | -------------------------- | ------------------------------------------------------------ |
| 1        |        web界面优化易用性提升                              |   覆盖指定单包增量测试、检查是否构建成功后回刷新至repo源、检查是否影响增量构建软件包依赖关系的识别；通过yaml创建流水线/创建project，检查相关字段的合法性校验、非空校验、相关字段参数组合嵌套关系的校验，镜像定制增加场景化侧边导航栏、支持rebuild二次提醒客户，web端新增UI界面信息正确性检查、支持在软件包下载页面查看归属job、支持在构建历史表格中展示全量/增量构建任务的repo发布结果、支持增量构建结果刷新至Build result等功能测试，共执行用例122条，整理质量良好。 | NA               | NA             | <font color=green>█</font> |                                                             |
| 2        |  spec传统os + yaml定制层                             | 主要覆盖验证：分层定制页面按钮功能校验，分层url输入框校验，web界面信息校验；验证支持各种定制场景,可以定制成功，并且在构建时生效；验证支持合并策略，可以按照定义的合并策略，合并多层的自定义配置，并且构建时使用的spec文件为合并后spec；验证支持多层定制，多层定制时，设置的层优先级可以生效；验证复杂的spec 文件多层定制不会出错；验证支持多个软件包定制；验证spec+yaml和yaml+yaml场景下不同架构可以出merge不同的spec；验证同一个包不同架构生成的source包一致；验证spec+yaml和yaml+yaml场景是否支持全量、增量、指定增量以及单包构建；验证web端和工具使用的各种异常场景，有合理报错提示；共执行用例65条，整体质量良好 | NA               | NA             | <font color=green>█</font>  |  |
|3| 异构测试机接入 | 覆盖验证龙芯架构机器接入全场景测试，验证异构机获取cbs tar包；验证部署脚本是否正常运行，multi_docker脚本是否正常运行；验证启动multi-docker后，执行机是否在队列中注册；验证后台增加删除新架构，前端架构下拉选择中是否新增或删除对应架构；验证测试机上是否有执行任务的容器在运行，验证异构机上是否运行ccache容器；验证前端触发单包、全量、增量、镜像构建任务选择龙芯架构，检查异构机是否可获取该任务并执行成功，共执行用例18条，整理质量良好 |NA|NA|<font color=green>█</font>  | |
| 4        |    安全加固  | 覆盖检查统一构建服务是否运行在multi-检查debian/alpine/openeuler是否更新为最新版本镜像，检查镜像是否成功构建，检查容器是否正常启动，运行单包、全量、增量、镜像构建检查业务是否正常运行共执行用例41条，通过工具对镜像进行扫描，共扫描出CVE类问题38个。 | NA               | NA                          | <font color=green>█</font>  |  |
| 5        | EulerMaker支持热补丁 | 主要覆盖了包含通过soe仓下评论触发热补丁工程的制作以及通过fork公仓提交pr的方式触发热补丁的制作，检查是否ACC/SGL类型的热补丁都能制作成功，针对 热补丁制作进展/结果回显检查，在soe仓下pr评论区回显信息的正确性检查，在hotpatch仓下PR评论区是否回显热补丁制作进度链接以及相关热补丁产物验证，使用syscare进行补丁管理，生成热补丁结果信息正确性检查；EBS平台触发热补丁命令检查/创建热补丁工程结果检查/获取历史job_id/本地复现热补丁制作任务环境，web端页面信息正确性检查，hotpacth仓下pr合入后是否触发安全公告、updateinfo信息收集以及issue评论区结果回显。共执行用例60条，整体质量良好。 | NA               | NA             | <font color=green>█</font> |                                                              |
| 6        |        支持本地命令行实现本地软件包构建                        | 覆盖通过命令对已有工程单包在本地进行构建，验证命令行参数是否校验；验证调试参数bp/bi/bc在对应阶段是否停止构建，可进入容器进行调试；验证构建容器镜像信息是否为工程spec_branch对应镜像；验证构建容器repofile格式是否与openEuler.repo相同，repofile源中设置3个源地址，验证3个源的优先级及不同场景下repofile包含不同的源；验证源信息中url是否拼接正确；验证容器中宏变量文件内容是否为build_env_macros值；验证构建日志是否存在及完整性，共执行25条用例，整体质量良好	| NA               | NA             | <font color=green>█</font> |                                                              |
| 7        |        基于分层定制和镜像定制生成树莓派镜像                   |  主要覆盖验证：定制业务包页面和版本定制页面各个输入框参数和页面按钮功能校验；验证镜像定制场景：不添加软件包镜像能构建成功，验证添加一个repo源中的部分软件包，镜像能建成功，验证添加多个不同repo中的软件包，源镜像能够构建成功，验证添加数量比较多的软件包是否能够构建成功，验证添加软件包之后再移除软件包，构建成功后的镜像中软件包是否被移除；验证版本定制：能够支持官方发布repo源；验证构建成功的镜像是可以正常下载；验证镜像定制用户添加的自定义软件包被默认安装，默认安装的软件包完整；验证构建成功的镜像格式正常；验证构建成功的镜像可以正常启动，并且包含添加的软件包；验证构建失败的场景，构建日志中的失败信息明确，共执行用例82条，整体质量良好     | NA               | NA             | <font color=green>█</font> |   该SR中的AR需求 建设嵌入式层，通过分层定制构建软件包 未转测  |

<font color=red>●</font>： 表示特性不稳定，风险高

<font color=blue>▲</font>： 表示特性基本可用，遗留少量问题

<font color=green>█</font>： 表示特性质量良好



# 5   问题单统计

给出版本问题单的分布或分类统计及问题单走势分析。

统一构建 930版本共发现问题单 101 个，其中缺陷类问题单 90 个，需求类问题单 6 个，有效问题 96 个，其中修复缺陷问题单 76 个，缺陷单闭环率85%，接纳需求单3个，需求单闭环率 50% 。详细分布见下表:

| 测试阶段     | 转测时间 | 发现问题 | 有效问题单数 | 无效问题单数 |需求问题单数|缺陷问题单数|  缺陷单闭环率   |   需求单闭环率  |
| :-:  | :-:  | :-: | :-: | :-: |:-: |:-: | :-: | :-: |
| EBS-930-SDV1 | 0824-0830   | 9  | 9  | 0  | 0 | 9  |  100%  |  \ |
| EBS-930-SDV2 | 0831-0906   | 13 | 13 | 0  | 0 | 13 |  100%  |  \ |
| EBS-930-SDV3 | 0907-0918   | 19 | 19 | 0  | 3 | 16 |  100%  |  67%  |
| EBS-930-SDV4 | 0919-1009   | 33 | 31 | 2  | 2 | 29 |  90%   |  50%  | 
| EBS-930-SIT1 | 1010-1101   | 25 | 22 | 3  | 1 | 21 |  48%   |  0  |
| EBS-930-SIT2 | 1102-1105   | 2  | 2  | 0  | 0 | 2  |  50%   |  \  |
| EBS-930-SIT3 | 1115-1116   | 0  | 0  | 0  | 0 | 0  |  \     |  \  |
| 总计         |  \          | 101 | 96 | 5  | 6 | 90 |   85%    |  50%  |




# 6 附件

## 遗留问题列表
| 序号 | 问题简述  | 问题级别 | 问题分析  |          影响分析                 | 规避措施           |
| ---- | -------- | -------- | ----------- | ---------------------------- | ------------------ |
|  1    |   squid服务代理问题导致包构建过程中下载包失败      |     中     |    使能squid功能会导致下载软件包失败，暂未定位到根因   |      下载软件包失败会导致构建软件包失败      |          去使能squid功能，软件包能正常构建          |
|  2    | yaml文件release_image_config:{iso_type}字段设置为eddesktop前后端无校验  |   低 | 后端未做类型检查   |  导致yaml上传成功  |  增加镜像类型校验       |
|  3    |      image_hd_partitions相关字段检查有误    |      低    |    1.不挂载情况下可以正常创建流水线<br>2.“定制业务包-删除其他文件”、“定制业务包-添加驱动”的配置中，前后端均将`/`视为了特殊字符并无法通过校验      |    1.无法进行不挂载的配置<br>2.文件路径包含`/`则无法正常填写    |    1.后端字段校验逻辑中将`-`视为合法值并通过校验<br>2.前后端的字段校验中均将该字段的`/`视为合法字符并通过校验                  |
|  4    |     web-backend_nginx & os_http镜像扫描busybox组件存在安全问题     |     低     |  Web-backend-nginx存在13个安全问题,Os_http存在安全问题CVE-2022-30065        |     Web-backend-nginx该镜像在测试环境及开发环境上均无对应容器在运行，业务未使用Os_http：允许远程攻击者造成拒绝服务并可能执行代码。利用精心制作的awk模式会触发漏洞。       |    后端环境存在白名单，不允许非名单用户远程访问，后续进行版本升级。                |
|  5    |     扫描remote-git镜像activesupport组件安全问题     |      低    |    存在安全问题CVE-2023-22796      |   这是一种拒绝服务（DoS）风险，由传递给下划线方法的特制字符串触发。该漏洞源于低效的正则表达式复杂性。攻击者可以利用此漏洞使系统过载，从而导致服务中断。         |      减少低效正则表达式风险，后续进行版本升级。              |
|  6    |    扫描web-hook镜像ansi-regex组件存在安全问题      |      低    |   存在安全问题CVE-2021-3807       |  由于低效的正则表达式复杂性而影响系统。解析无效的ANSI转义序列可能会导致拒绝服务。          |      未使用低效的正则表达式。后续版本更新。              |
|  7    |    master_fluentd镜像扫描elasticsearch组件存在安全问题      |      低    |      存在安全问题CVE-2021-22147、CVE-2021-22137、CVE-2021-22145、CVE-2021-22144    |    1.此缺陷可能允许经过身份验证的用户访问这些快照中的敏感数据。影响包括潜在的高保密风险，但需要低权限和用户交互。<br>2.使用文档级或字段级安全性时，搜索查询可能会暴露敏感信息<br>3.通过错误报告可能暴露敏感信息<br>4.允许用户创建恶意Grok查询，使Elasticsearch节点崩溃，可能导致拒绝服务攻击规避措施  |      由于es镜像版本原因暂时无法升级版本 |
|  8    |   auto-submit镜像扫描handlebars组件存在安全问题       |   低    |     存在安全问题CVE-2021-23369、CVE-2021-23383、CVE-2019-20922、CVE-2019-20920     |      CVE-2021-23369是版本4.7.7之前的Handlebars包中的一个漏洞，当在来自不受信任来源的模板上使用特定编译选项时，它会启用远程代码执行（RCE）。该缺陷影响Node.js的handlebas模块，使攻击者能够在系统上执行任意代码。4.4.5之前的Handlebars版本由于其解析机制中的迫切匹配而容易受到ReDoS的影响。攻击者可以利用这一点，可以通过操纵在正则表达式匹配中触发过度回溯的输入来造成拒绝服务。      |      避免从不受信任的来源编译模板。后续将Handlebars升级至4.7.7或更新版本。              |
|  9    |   es镜像扫描jackson-databind组件存在安全问题       |      低    |   存在安全问题CVE-2023-35116       |    该漏洞允许攻击者通过使用循环依赖关系的特制对象造成拒绝服务或其他未指定的影响。        |    未使用循环依赖关系，后续版本升级。       |
|  10    |  web-hook镜像扫描lodash组件存在安全问题       |      低    |    存在安全问题CVE-2020-8203、CVE2021-23337、CVE-2020-28500      |    1.漏洞在lodash中使用_.zipObjectDeep时的原型污染攻击，使攻击者能够修改对象的原型，并可能执行任意代码。<br>2.易受通过模板函数进行命令注入的影响。<br>3.通过toNumber、trim和trimEnd函数导致正则表达式拒绝服务（ReDoS）。此问题可能使攻击者利用效率低下的正则表达式造成拒绝服务       |      不使用_.zipObjectDeep、toNumber、trim和trimEnd函数，利用lodash的易受攻击功能审查代码，以识别和解决潜在风险，对用户输入进行消毒，以防止注入攻击。后续进行组件升级。             |
|  11    |  remote-git镜像扫描minimatch组件存在安全问题        |      低    |   存在安全问题CVE-2022-3517       |     在调用braceExpand函数时会导致正则表达式拒绝服务（ReDoS）。此漏洞使攻击者能够操纵输入，导致处理时间过长，并可能导致拒绝服务的情况。利用可能导致资源耗尽和系统不可用。       |     不使用braceExpand函数，后续对组件进行升级。               |
|  12    |  web_backend_nginx镜像扫描nginx组件存在安全问题        |      低    |   镜像安全扫描nginx组件存在3个安全问题        |     该镜像在测试环境及开发环境上均无对应容器在运行，业务未使用       |       不使用该业务             |
|  13    |  web-hook镜像扫描path-parse组件存在安全问题        |      低    |    存在安全问题CVE-2021-23343      |     该问题源于splitDeviceRe、splitTailRe和splitPathRe中的正则表达式拒绝服务（ReDoS）漏洞。此漏洞使攻击者能够执行ReDoS攻击，从而可能导致服务中断或拒绝。       |     持续监控与ReDoS攻击有关的任何可疑活动或企图利用漏洞。遵循安全最佳实践，包括代码审查、输入验证和限制资源，以最大限度地减少潜在攻击的影响。后续进行升级。               |
|  14    |  master_fluentd镜像扫描webrick组件存在安全问题      |   低    |     存在安全问题CVE-2008-1145     |      CVE-2008-1145 描述了 Ruby 在处理多字节字符时的一个缓冲区溢出漏洞，攻击者可以通过构造特制的 HTTP 请求触发这个漏洞，导致远程执行任意代码。这个漏洞在处理特定字符编码时存在缺陷，可能导致栈溢出       |      加强监控系统，关注异常行为。设置日志记录并定期检查，以便及时发现潜在的攻击尝试或异常活动，后续进行组件升级。           |