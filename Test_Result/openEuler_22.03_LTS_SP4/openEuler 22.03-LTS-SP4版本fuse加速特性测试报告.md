![avatar](../../images/openEuler.png)


版权所有 © 2023  openEuler社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期 | 修订   版本 | 修改描述 | 作者 |
| ---- | ----------- | -------- | ---- |
|   2025/06/24   |  v1.0           |  新增 FUSE 加速特性测试报告   |  陈仁辉    |


关键词： FUSE加速特性 测试报告

摘要：FUSE 框架允许非 root 用户在用户空间创建自己的文件系统，但会带来较大的性能负面影响。FUSE 加速特性通过预创建线程绑核、共享内存、快速进程切换提高了 FUSE 框架的性能。依据测试要求，对FUSE加速特性进行基本功能和性能测试。


缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
|     FUSE   |    Filesystem in Userspace      |    用户态文件系统      |

# 1     特性概述

FUSE 框架允许非 root 用户在用户空间创建自己的文件系统。
当前版本新增功能点为：允许 use_fastpath 挂载选项，相较未使能状态性能提升。

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称 | 测试起始时间 | 测试结束时间 |
| -------- | ------------ | ------------ |
|  openEuler-22.03-LTS-SP4 update  2025/05/30   |       2025/06/13       |       2025/06/24       |


描述特性测试的硬件环境信息

| 硬件型号 | 硬件配置信息 | 备注 |
| -------- | ------------ | ---- |
| kunpeng 920 | 64 核 |    物理机      |

# 3     测试结论概述

## 3.1   测试整体结论

FUSE 加速特性，共计执行 20 个用例，主要覆盖了功能测试、性能测试和可靠性测试，经过测试发现问题已解决，回归通过，无遗留风险，整体质量良好。

| 测试活动 | 测试子项 | 活动评价 |
| ------- | -------- | ------- |
| 功能测试 | 新增特性测试 |   使用 passthrough_hp 挂载，支持 use_fastpath 选项，正常挂载成功，符合预期   |
| DFX专项测试 | 性能测试 |   使用 passthrough_hp 挂载，使能use_fastpath，使用 fio 测试性能，对比原生提升 91 %   |
| DFX专项测试 | 可靠性/韧性测试 | 使用cephfs挂载，测试大压力长稳、客户端交叉、系统资源故障过载、网络故障、进程故障等问题，通过测试 |
| 资料测试 |   NA      |    新增《FUSE fastpath特性说明和使用指南》     |

## 3.2   约束说明

仅支持 ARM64 处理器。

# 4 详细测试结论

## 4.1 功能测试

### 4.1.1 新增特性测试结论

| 序号 | 组件/特性名称 | 特性质量评估 | 备注 |
| --- | ----------- | :--------: | --- |
| 1 | FUSE use_fastpath 挂载选项支持 | <font color=green>■</font> |   |

## 4.2 DFX专项测试结论

### 4.2.1 性能测试结论

| 指标大项 | 指标小项 | 指标值 | 测试结论 |
| ------- | ------- | ------ | ------- |
|    多线程IO吞吐     |    fio 测试 24 线程读写     |    较原生提高10%    |     测试通过    |

### 4.2.2 可靠性/韧性测试结论

本节使用真实场景 cephfs 挂载，在集群环境中测试。

| 测试类型 | 测试内容 | 测试结论 |
| ------- | ------- | -------- |
|    大压力长稳     |    3 客户端同时下发高并发 IO，构造大压力场景随机、顺序读写，预期集群正常，IO 正常结束，写入文件能删除且数据量减少符合预期     |     测试通过     |
|    客户端交叉     |    分别使用 FUSE 改造后客户端和原生客户端进行交叉读写一致性校验，预期 IO 正常结束，写入文件能删除且数据量减少符合预期     |     测试通过     |
|    系统资源故障过载     |    使用 cfe 工具构造 cpu 持续资源占用，预期故障注入后 IO 未中断，流量变小。故障恢复后流量恢复，IO 正常结束，写入文件能删除且数据量减少符合预期     |     测试通过     |
|    网络故障     |    构造 public 网络故障，预期 IO 过程中构造故障（随机丢包、链路闪断、中断、时延，持续 1 min），IO 断流。故障恢复后，IO 恢复正常，一致性校验通过。     |     测试通过     |
|    进程故障     |    构造进程故障，预期 IO 过程中构造故障（单节点 mds、单节点 osd、客户端 fio、客户端 fuse），IO 断流或直接结束。故障恢复后，IO 恢复正常，断流 IO 恢复正常，异常结束 IO 重新西下发可正常写入，一致性校验通过。     |     测试通过     |

## 4.3 资料测试结论

| 测试类型 | 测试内容 | 测试结论 |
| ------- | ------- | -------- |
|    指南说明     |    新增《FUSE fastpath特性说明和使用指南》https://docs.openeuler.org/zh/docs/22.03_LTS_SP4/docs/Administration/FUSE%E5%8A%A0%E9%80%9F%E7%89%B9%E6%80%A7%E6%8C%87%E5%8D%97.html     |     测试通过     |

# 5     测试执行

## 5.1   测试执行统计数据


| 版本名称 | 测试用例数 | 用例执行结果 | 发现问题单数 |
| -------- | ---------- | ------------ | ------------ |
|    openEuler-22.03-LTS-SP4 update 2025/05/30      |       20     |      pass        |      3        |
