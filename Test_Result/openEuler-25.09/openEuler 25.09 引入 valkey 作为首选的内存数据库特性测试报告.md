# openEuler 25.09 引入 valkey 作为首选的内存数据库特性测试报告

![avatar](../../images/openEuler.png)

版权所有 © 2025  openEuler社区
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

|日期|修订   版本|修改描述|作者|
| ------------| -------------| -------------------------------------------------------------------------------| --------|
|2025/09/10|v1|初始报告|Funda Wang|
|2025/09/24|v2|更换标题及描述，补充内容|Funda Wang|

关键词：内存数据库 valkey redis

摘要：引入 valkey 作为首选的内存数据库。

缩略语清单：

| 缩略语 | 英文全名                           | 中文解释       |
| --------| ----------| ----------|

# 1     特性概述

背景：2024年，redis将其许可证体系从开源BSD许可证调整为双重源代码可用许可证（Redis Source Available License v2, RSALv2与Server Side Public License v1, SSPLv1）。此次变更自redis 7.4分支起生效，由于RSALv2和SSPLv1均不符合开源定义（OSD）标准，导致相关版本不再被视为开源软件。基于Redis的版本生命周期管理策略及行业发行版实践，openEuler决定引入valkey（Linux 基金会支持下的分支项目）作为后续版本的首选内存数据库解决方案。

# 2     特性测试信息

|版本名称|转测轮次|测试起始时间|测试结束时间|
| --------------------------------------------| --------------| --------------| --------------|
|openEuler-25.09|RC5|2025/09/10|2025/09/11|


| 软件名称 | 软件版本 | 备注          |
| ---------| -------- | ------------- |
| valkey   | 8.1.3-4  |               |


# 3     测试结论概述

## 3.1   测试整体结论

valkey 是 Linux 基金会管理的高性能开源键值型数据库。经过对指定软件版本软件的形式测试，软件服务启动和关闭正常，软件活动状态正常。符合软件上游设计初衷。

## 3.2   约束说明

无

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

无遗留问题

### 3.3.2 问题统计

无测试问题

# 4 详细测试结论

## 4.1 功能测试

|序号|组件/特性名称|特性质量评估|备注|
|----|-------------|------------|----|
|1|单节点服务启动测试|<font color=green>■</font>|`systemctl start valkey`|
|2|单节点服务停止测试|<font color=green>■</font>|`systemctl stop valkey`|
|3|哨兵节点服务启动测试|<font color=green>■</font>|`systemctl start valkey-sentinel`|
|4|哨兵节点服务停止测试|<font color=green>■</font>|`systemctl stop valkey-sentinel`|
|5|单节点服务活跃相应测试|<font color=green>■</font>|`ping/pong`|

<font color=red>●</font>： 表示特性不稳定，风险高
<font color=blue>▲</font>： 表示特性基本可用，遗留少量问题
<font color=green>■</font>： 表示特性质量良好

## 4.2 兼容性测试结论

本软件是 openEuler 25.09 新增的软件，与既往 LTS 版本不产生兼容性问题。

## 4.3 DFX专项测试结论

### 4.3.1 性能测试结论

Valkey 8.0 对现有的 I/O 线程系统进行了显著改进，允许主线程和 I/O 线程并发运行。8.0 版本还包括多项改进，旨在将工作分载到 I/O 线程，并引入高效的命令批处理。Valkey 8.0 在 AWS 的 r7g 平台上旨在处理高达每秒 120 万次查询 (QPS)，而之前的限制是 38 万次 QPS。[1]

[1]: https://valkey.io/blog/valkey-8-0-0-rc1/

### 4.3.2 可靠性/韧性测试结论

Valkey 8.0 通过以下增强功能提高了可靠性，并最大限度地减少了中断：

- **空分片自动故障转移** 新的空分片（不拥有任何槽）现在受益于自动故障转移。这确保了从扩展过程开始就具备高可用性。
- **槽迁移状态的复制** 所有 CLUSTER SETSLOT 命令现在在主节点上执行之前会同步复制到副本节点。这减少了主节点发生故障时不可用的可能性，因为副本节点拥有关于分片状态的最新信息。新的副本节点还会自动从主节点继承状态，无需操作员额外输入。
- **槽迁移状态恢复** 在发生故障转移时，Valkey 会自动更新源节点和目标节点上的槽迁移状态。这确保了请求持续路由到目标分片中的正确主节点，从而维护集群的完整性和可用性。

### 4.3.3 安全测试结论

不涉及

## 4.4 资料测试结论

不涉及

## 4.5 其他测试结论

不涉及

# 5     测试执行

## 5.1   测试执行统计数据

|版本名称|测试用例数|用例执行结果|发现问题单数|
|--------|----------|------------|------------|
|valkey-8.1.3-4|1|成功1个|0|
