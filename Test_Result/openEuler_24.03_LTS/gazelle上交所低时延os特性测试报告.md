![avatar](../../images/openEuler.png)


版权所有 © 2024  openEuler社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期 | 修订   版本 | 修改描述 | 作者 |
| ---- | ----------- | -------- | ---- |
|    2024-05-11  |           V1.0  |      创建      |  陈仕娟    |

关键词： udp igmpV3

摘要：gazelle是一款高性能用户态协议栈。它基于DPDK在用户态直接读写网卡报文，共享大页内存传递报文，使用轻量级LwIP协议栈。能够大幅提高应用的网络I/O吞吐能力


缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
|     IGMP   |    InternetGroupManagementPtotocol      |     互联网组管理协议,是TCP/IP协议族中负责IPV4组播成员管理的协议     |

# 1     特性概述

本次特性主要包含三个功能<br />
1）支持TCP ipv4&ipv6，与UDP的混合模式<br />
2）支持igmp V3协议<br />
3）支持udp 组播本地回环<br />
4）netper支持UDP_STREAM 和UDP_RR<br />

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称            | 测试起始时间 | 测试结束时间 |
| ------------------- | ------------ | ------------ |
| openEuler 24.03-LTS | 2024/4/15    | 2024/4/19    |
| openEuler 24.03-LTS | 2024/4/22    | 2024/4/30    |
| openEuler 24.03-LTS | 2024/5/8     | 2024/5/15    |

描述特性测试的硬件环境信息


| 硬件型号 | 硬件配置信息 | 备注 |
| -------- | ------------ | ---- |
|      2288H V5    |       CPU型号：Intel(R) Xeon(R) Gold 6278C <br />CPU核数：48 <br />网卡：Hi1822       |      |
|     TaiShan200 2280     |   CPU型号：Kunpeng 920 <br />CPU核数：96 <br />网卡：Hi1822           |      |
# 3     测试结论概述

## 3.1   测试整体结论

gazelle 上交所低时延os特性，共计执行160个用例，主要覆盖了功能测试、可靠性测试、性能测试，通过7*24的长稳测试，本次测试共发现25个issue，当前4个issue待解决

| 测试活动 | 测试子项 | 活动评价 |
| ------- | -------- | ------- |
| 功能测试 | 继承特性测试 | 部分通过 |
| 功能测试 | 新增特性测试 | 部分通过 |
| DFX专项测试 | 性能测试 | 部分通过 |
| DFX专项测试 | 可靠性       | 测试通过 |
| 资料测试 |              | 测试通过 |

## 3.2   约束说明

1）udp当前仅支持单lstack线程场景，多lstack线程场景暂不支持
2）bond1和vlan相关功能基于物理机mlx网卡测试
3）ltran模式在当前版本衰退


## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 序号 | 问题单号 | 问题简述 | 问题级别 | 影响分析 | 规避措施 |
| --- | ------- | ------ | ------- | ------- | ------- |
| 1 | I9JA5Z | ltran模式，带gazelle启动服务端时将日志重定向到文件，printf的内容不能正常显示到文件 | 次要 | 当前ltran功能已在资料中增加衰退说明，当前主要影响5条继承用例 | 不重定向到文件，对应的日志可以正常打印 |
| 2 | I9OKPL | 单端本地回环下大包会出现回环的流断流 | 次要 | 影响大包单端本地回环,测试工具问题 | 增加mbuf或者双端都使用本地回环可规避 |
| 3 | I9P47D | 客户端用户态组播打流，服务端2打流一会之后出现断流 | 次要 | 单客户端用户态组播,测试工具问题 | 使用双端用户态规避 |
| 4 | I9OGEZ | bond1模式下，开启vlan模式不进行过滤 | 次要 | bond1和vlan组合网卡直连场景 | 使用网卡连接交换机可以规避 |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   | 25       | 0    | 5    | 18   | 2      |
| 百分比 | 100%     | 0%   | 20%  | 72%  | 8%     |

# 4 详细测试结论

## 4.1 功能测试
*开源软件：主要关注开源软件升级后的变动点，继承特性由开源软件自带用例保证（需额外关注软件包提供可执行命令、库、服务功能）*
*社区孵化软件：主要参考以下列表*

### 4.1.1 继承特性测试结论

| 序号 | 组件/特性名称 | 特性质量评估 | 备注 |
| --- | ----------- | :--------: | --- |
| 1 | lstack配置文件 | <font color=green>■</font> |   |
| 2 | 仅lstack转发 | <font color=blue>▲</font> |   |
| 3 | gazellectl调测命令 | <font color=blue>▲</font> | |

<font color=red>●</font>： 表示特性不稳定，风险高
<font color=blue>▲</font>： 表示特性基本可用，遗留少量问题
<font color=green>■</font>： 表示特性质量良好

### 4.1.2 新增特性测试结论

| 序号 | 组件/特性名称 | 特性质量评估 | 备注 |
| --- | ----------- | :--------: | --- |
| 1 | 支持TCP ipv4&ipv6，与UDP的混合模式 | <font color=red><font color=blue>▲</font></font> |   |
| 2 | 支持igmp V3协议 | <font color=blue>▲</font> |   |
| 3 | 支持udp 组播本地回环 | <font color=blue>▲</font> | |
| 4 | netper支持UDP_STREAM 和UDP_RR | <font color=green>■</font> | |

<font color=red>●</font>： 表示特性不稳定，风险高
<font color=blue>▲</font>： 表示特性基本可用，遗留少量问题
<font color=green>■</font>： 表示特性质量良好

## 4.2 DFX专项测试结论

### 4.2.1 性能测试结论

| 指标大项 | 指标小项 | 指标值 | 测试结论 |
| ------- | ------- | ------ | ------- |
| 时延 | netperf UDP_RR 256包长时延 | 较内核优化50% | 测试通过 |
| 时延 | netperf UDP_RR 8192包长时延 | 相对内核不劣化 | 测试通过 |
| 吞吐 | netperf UDP_STREAM带宽 | 相对内核不劣化 | 测试通过 |

### 4.2.2 可靠性测试结论

| 测试类型 | 测试内容 | 测试结论 |
| ------- | ------- | -------- |
| 压力测试 | udp最大包长测试及应用多线程测试 | 测试通过 |

## 4.3 资料测试结论
| 测试类型 | 测试内容 | 测试结论 |
| ------- | ------- | -------- |
| 资料测试 | 1.新增特性及约束检查 <br />2.删除特性ltran及kni相关内容去除检查 | https://gitee.com/openeuler/docs/pulls/13766 |

## 

# 5     测试执行

## 5.1   测试执行统计数据

*本节内容根据测试用例及实际执行情况进行特性整体测试的统计，可根据第二章的测试轮次分开进行统计说明。*

| 版本名称            | 测试用例数 | 用例执行结果                                        | 发现问题单数 |
| ------------------- | ---------- | --------------------------------------------------- | ------------ |
| openEuler 24.03-LTS | 144        | 通过106个失败38个                                   | 14个         |
| openEuler 24.03-LTS | 144        | 通过129个失败15个                                   | 8个          |
| openEuler 24.03-LTS | 160        | 通过148个失败12个（其中5个失败为删除特性ltran相关） | 3个          |
| openEuler 24.03-LTS | 160        | 通过160个失败0个 | 0个          |

*数据项说明：*

*测试用例数－－到本测试活动结束时，所有可用测试用例数；*

*发现问题单数－－本测试活动总共发现的问题单数。*

## 5.2   后续测试建议

对于igmpV3本次只进行基本功能测试，后续需要继续关注大规格测试
 