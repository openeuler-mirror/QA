 ![avatar](../../images/openEuler.png)


版权所有 © 2023  openEuler社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期       | 修订   版本 | 修改描述 | 作者   |
| ---------- | ----------- | -------- | ------ |
| 2024-11-26 | v1.0        | 初稿     | 郑毅文 |
|            |             |          |        |

关键词： 混合部署、rubik、cpu&mem水位线、pod驱逐、systemd cgroup driver

摘要：rubik通过支持节点cpu、mem水位线控制来保障在线业务服务质量，本文主要叙述测试覆盖情况及测试结论。

# 1     特性概述

随着云原生技术的发展，将在线（高优先级）、离线（低优先级）业务混合部署成为了当下提高资源利用率的有效手段。rubik容器调度在业务混合部署的场景下，根据 QoS 分级，对资源进行合理调度，从而实现在保障在线业务服务质量的前提下，大幅提升资源利用率。 

本次需求rubik新增以下特性：

1. 节点CPU驱逐水位线控制：当窗口期平均CPU资源使用率超过设定驱逐水位线，驱逐低优Pod，控制节点CPU水位 
2. 节点内存水位线控制：当内存资源使用率超过设定驱逐水位线，驱逐低优Pod，控制节点内存水位
3. Rubik支持systemd cgroup driver

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称                        | 测试起始时间 | 测试结束时间 |
| ------------------------------- | ------------ | ------------ |
| rubik-2.0.1-1.oe2403sp1.aarch64 | 2024-11-18   | 2024-11-25   |
|                                 |              |              |

# 3     测试结论概述

## 3.1   测试整体结论

openEuler云原生混部能力使能联通云特性，共计执行6个用例，主要覆盖了参数测试、功能测试和可靠性测试，发现问题已解决，回归通过，无遗留风险，整体质量良好；

| 测试活动    | 测试子项                                               | 活动评价       |
| ----------- | ------------------------------------------------------ | -------------- |
| 功能测试    | 接口参数测试                                           | 未发现问题     |
| 功能测试    | 节点CPU/内存驱逐水位线控制功能测试、支持systemd cgroup | 发现问题已解决 |
| DFX专项测试 | 可靠性                                                 | 未发现问题     |
| 资料测试    |                                                        | 检视意见已闭环 |

## 3.2   约束说明

无约束说明

## 3.3   遗留问题分析

不涉及遗留问题

# 4 详细测试结论

## 4.1 功能测试
### 4.1.1 功能测试结论

功能测试覆盖接口测试和特性基本功能测试：

1、接口测试rubik驱逐水位线配置文件新增参数有效和无效参数验证，测试结果符合预期。

2、功能覆盖cpu水位线控制、内存水位线控制，验证在cpu或内存达到驱离水位线时，离线pod按照预期逐个被驱离，在线pod不受影响。功能符合预期。

3、容器运行时和k8s配置systemd cgroup驱动，rubik配置cgroup驱动为systemd，验证rubik功能运行正常，可以正常配置在线离线pod，完成驱逐功能。

## 4.2 DFX专项测试结论

### 4.2.1 可靠性测试结论

可靠性测试大量离线pod运行场景下，rubik功能正常运行，资源使用未见异常。

## 4.4 资料测试结论
资料PR链接：https://gitee.com/openeuler/docs/pulls/14288

检视意见均已闭环。

# 5     测试执行

## 5.1   测试执行统计数据

| 版本名称                    | 测试用例数 | 用例执行结果     | 发现问题单数 |
| --------------------------- | ---------- | ---------------- | ------------ |
| openEuler-24.03-LTS-SP1-rc1 | 6          | 5 PASS，1 FAILED | 1            |
| openEuler-24.03-LTS-SP1-rc2 | 6          | 6 PASS           | 0            |

