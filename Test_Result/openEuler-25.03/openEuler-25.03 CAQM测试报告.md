![avatar](../../images/openEuler.png)


版权所有 © 2025  openEuler社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期 | 修订   版本 | 修改描述 | 作者 |
| ---- | ----------- | -------- | ---- |
| 2025-03-16 | 1.0   | 新增     | 汪乐平 |
|      |             |          |      |

关键词： 拥塞控制算法、网络性能

摘要：本报告主要描述基于openEuler 25.03版本对CAQM的测试过程，报告对测试情况进行说明，对特性的测试充分度进行评估和总结。

缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
| CAQM | Confined Active Queue Management | 零队列拥塞控制 |
| RSS | Receive-side scaling | 多队列接收 |
| TSO | TCP Segmentation Offload | 利用网卡对大数据包分段，降低CPU负载 |

# 1     特性概述

CAQM是一种新的拥塞控制算法。它通过在数据包中增加拥塞窗口变化量的信息来更好地协调终端与交换机，降低队列使用。

该特性的编译宏未打开，使用时、需要开启内核编译宏，重新编译内核做替换。

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称              | 测试起始时间 | 测试结束时间 |
| -------------------- | ------------ | ------------ |
| openEuler-25.03/rc3  | 2025-03-01    | 2025-03-10    |

描述特性测试的硬件环境信息

| 硬件型号 | 硬件配置信息 | 备注 |
| -------- | ------------ | ---- |
| 服务器 RH2288H V3  | 双路Intel(R) Xeon(R) CPU E5-2620 v3 @ 2.40GHz <br> Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection  | 网卡固件为出厂默认固件  |
| 交换机 CE6885M-48YS8CQ    |  盒式交换机的标准配置 | 具体支持CAQM的款型请和厂家确认 |

# 3     测试结论概述

## 3.1   测试整体结论

共进行1轮测试，执行了3种测试套，包括以下测试（功能测试/性能测试/可靠性测试）：

1. CAQM自身的标准性能测试5项，RPS、GRO、GSO都生效，流量正常。
2. CAQM自身功能用例6项，验证互通性、参数配置性等。
3. CAQM应用在Postgres SQL场景，在有背景流的场景下，通过benchmark sql对比测试性能提升。

发现0个问题，遗留问题无。

## 3.2   约束说明

当前需要网络中间设备（交换机）**必须**支持CAQM特性；当前支持的厂家有：华为。其他交换机厂商的支持在推动中。

端侧网卡如果支持CAQM，能取得更高的吞吐(使得RSS、TSO加速得到兼容)。当前支持的网卡厂家有： 华为、云脉。

需要开启内核编译宏。

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

无遗留问题。

### 3.3.2 问题统计

未发现问题。

# 4 详细测试结论

## 4.1 CAQM的功能测试

### 4.1.1 RPS生效的证明

运行2打1的CAQM测试，后台使用top命令，查看CPU负载情况：

可以看到，si(软中断)的CPU占用在3个核上都有存在

### 4.1.2 GRO生效的证明

使用perf采集CPU 0核上的情况（该核作为srv端），发现：调用至tcp\_gro\_receive，证明相关网包走到GRO后续处理流程。

### 4.1.3 GSO生效的证明

使用perf采集CPU 11核上的运行情况（该核作为cli端），发现调用至tcp\_gso\_segment，证明网包正确走到GSO的处理。

## 4.2 兼容性测试

### 4.2.1 caqm作为cli, 非caqm作为srv

使用iperf命令，让cli启用caqm，测试能够互通，交换机上抓包、显示网包为正常格式（不带CAQM）

### 4.2.2 caqm作为srv, 非caqm作为cli

互通，交换机抓到的包为正常包

### 4.2.3 caqm同时作为cli和srv

能够互通，交换机上抓到CAQM格式的payload包和ACK包

### 4.2.4 OS版本兼容性

OpenEuler 24.03 LTS-SP1版本增加的caqm通信，25.03版本与其可正常互通。

## 4.3 DFX专项测试结论

### 4.3.1 性能测试结论

标准3打1场景，caqm队列深度在200KB以下；BBR在500KB；Cubic在5MB以上。
符合caqm设计预期，和之前测试结果一致。

### 4.3.2 可靠性/韧性测试结论

测试方法：直接scapy构造各种坏包，做注入；来判断是否OK。

注入了CAQM不全的包（只有tpid、没有后续内容），各种vlan头的包。
内核都正常工作。

### 4.3.3 安全测试结论

NA

## 4.4 资料测试结论

NA

## 4.5 其他测试结论

NA

# 5     测试执行

## 5.1   测试执行统计数据

1. CAQM自身的标准性能测试5项，RPS、GRO、GSO都生效，流量正常。
2. CAQM自身功能用例6项，验证互通性、参数配置性等。
3. CAQM应用在Postgres SQL场景，在有背景流的场景下，通过benchmark sql对比测试性能提升。

发现0个问题，遗留问题无。

## 5.2   后续测试建议

增加纯软用例到社区，避免测试对特定组网环境的依赖。

# 6     附件

NA

 