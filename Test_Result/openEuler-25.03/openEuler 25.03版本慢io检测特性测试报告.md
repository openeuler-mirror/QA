![avatar](../../images/openEuler.png)


版权所有 © 2025  openEuler社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期 | 修订   版本 | 修改描述 | 作者 |
| ---- | ----------- | -------- | ---- |
|   2025.03.12   |        v1.0   |   测试报告初版       |    谢守航  |
|      |             |          |      |

关键词： sysSentry、慢IO



缩略语清单：

| 缩略语 | 英文全名 | 中文解释 |
| ------ | -------- | -------- |
|    慢IO    |    IO Fail-Slow      |     IO请求的平均服务时间超出预期     |
|        |          |          |

# 1     特性概述

本次需求为sysSentry精准慢IO检测能力5.10/6.6内核内核同步，该功能主要是提升GaussDB在系统出现慢IO场景下的可靠性，当系统中存在由于磁盘故障、IO栈异常时，能够快速检测识别慢IO，能够根据操作系统sysSentry提供的慢IO时间，及时进行告警上报以及倒换，快速恢复业务，提升数据库业务的可用性。

sysSentry各个模块新增了以下能力：

新增采集模块，支持对磁盘、网络等系统模块的数据采集，用于支持插件功能实现，需求新增采集模块，并增加以下数据采集方式：
（1）基于内核无锁方案的IO数据采集
（2）基于ebpf打桩的IO数据采集
sysSentry巡检插件模块新增两种慢IO检测算法插件：
（1）基于平均阈值的慢IO检测插件
（2）基于AI阈值的慢IO检测插件
插件管理模块新增查看告警事件信息命令，支持用户直接通过命令行的方式查询插件对应的告警事件信息
分别提供python和C的对外接口，用户可以基于该lib库接口自动编写接收告警时间，并进行处理

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称 | 测试起始时间 | 测试结束时间 |
| -------- | ------------ | ------------ |
|  openEuler 22.03-lts-sp4版本       |    2025.02.14          |       2025.03.10       |
|  openEuler 24.03-lts-sp1版本(第一轮)       |    2025.02.14          |       2025.03.10       |
|  openEuler 24.03-lts-sp1版本(第二轮)       |    2025.02.25          |       2025.03.10       |

描述特性测试的硬件环境信息

| 硬件型号 | 硬件配置信息 | 备注 |
| -------- | ------------ | ---- |
|    物理机      |      nvme-ssd、sata-ssd、sata-hdd        |  ARM版本和X86版本    |

# 3     测试结论概述

## 3.1   测试整体结论

慢IO特性总共进行两轮转测，合计执行用例 28 个，主要覆盖了 API 测试、功能测试，发现问题 1 个，暂未闭环（已转任务跟踪）。

| 测试活动 | 测试子项 | 活动评价 |
| ------- | -------- | ------- |
| 功能测试 | 覆盖慢IO配置文件的正常/异常值测试，覆盖基于无锁和ebpf的采集服务，覆盖平均阈值和ai阈值的慢IO检测算法，覆盖xalarm告警服务 |      |
| 场景测试 | 	覆盖IO压力大、IO栈异常、慢IO场景 |      |
| 接口测试 |    覆盖get_alarm接口， 覆盖注册/取消/更新告警订阅、获取告警信息接口      |       |

## 3.2   约束说明

| 序号 | 约束 |
| ------- | -------- |
| 1 | 22.03-lts-sp4版本内核未合入内核无锁特性补丁 |
| 2 | 磁盘名不超过32个字符 |
| 3 | 采集周期取值在1到300之间，并且为period_time值的整数倍，且倍数不超过max_save（两个数值请参考/etc/sysSentry/sentryCollector.conf） |
| 4 | 磁盘列表磁盘个数不超过10个，如果超过10个，默认取前10个 |
| 5 | 采集阶段个数不超过15个 |
| 6 | 告警id限制取值范围为1001-1128 |

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

| 序号 | 问题单号 | 问题简述 | 问题级别 | 影响分析 | 规避措施 | 历史发现场景 |
| --- | ------- | ------ | ------- | ------- | ------- | ---------- | 
|   1  |    https://gitee.com/src-openeuler/sysSentry/issues/IBSNK3?from=project-issue     |   慢io检测ai阈值插件，5.10内核ai巡检插件，日志里会打印ebpf采集所不支持阶段的阈值信息     |     建议    |    不影响功能     |    转任务跟踪     |            |

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   |     1     |  0    |   0   |   1   |    0    |
| 百分比 |          |      |      |  100%    |        |

# 4 详细测试结论

## 4.1 功能测试

| 测试内容 | 测试结论 |
| ------- | -------- |
| IO采集配置文件测试 | 通过 |
| 告警插件配置文件测试 | 通过 |
| 平均阈值算法配置文件测试 | 通过 |
| ai阈值算法配置文件测试 | 通过 |
| 基于无锁的采集功能测试 | 通过 |
| 基于ebpf的采集功能测试 | 通过 |
| 基于平均阈值的IO检测算法测试 | 通过 |
| 基于ai阈值的IO检测算法测试 |通过  |

## 4.2 场景测试

| 测试内容 | 测试结论 |
| ------- | -------- |
| 无锁 + IO异常（IO压力大、IO栈异常、慢IO）+ 平均阈值算法 + 告警测试 | 通过 |
| 无锁 + IO异常（IO压力大、IO栈异常、慢IO）+ ai阈值算法 + 告警测试 | 通过 |
| ebpf + IO异常（IO压力大、IO栈异常、慢IO）+ 平均阈值算法 + 告警测试 | 通过 |
| ebpf + IO异常（IO压力大、IO栈异常、慢IO）+ ai阈值算法 + 告警测试 | 通过 |

## 4.3 接口测试

| 测试内容 | 测试结论 |
| ------- | -------- |
| get_alarm接口正常/异常值测试 | 通过 |
| C语言告警订阅接口测试 | 通过 |
| python语言告警订阅接口测试 | 通过 |

## 5.1   测试执行统计数据

*本节内容根据测试用例及实际执行情况进行特性整体测试的统计，可根据第二章的测试轮次分开进行统计说明。*

| 版本名称 | 测试用例数 | 用例执行结果 | 发现问题单数 |
| -------- | ---------- | ------------ | ------------ |
|    openEuler 22.03-lts-sp4版本      |     28       |       pass       |      1        |
|    openEuler 24.03-lts-sp1版本      |     28       |       pass       |      0        |



# 6     附件
无