![openEuler ico](../../images/openEuler.png)

版权所有 © 2021  openEuler社区
您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问[*https://creativecommons.org/licenses/by-sa/4.0/*](https://creativecommons.org/licenses/by-sa/4.0/) 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：[*https://creativecommons.org/licenses/by-sa/4.0/legalcode*](https://creativecommons.org/licenses/by-sa/4.0/legalcode)。

修订记录

| 日期       | 修订版本 | 修改章节 | 修改描述   |
| ---------- | -------- | -------- | ---------- |
| 2023/8/02 | 1.1.0    | 初始     | yangshicheng/baijing |

**关键词：**

统一构建平台测试策略 业务检测、构建成功率提升、架构扩展、统一账号、构建依赖可视化、手动bisect能力、镜像扩展、RadiaTest适配。

**摘要：**

文本主要描述统一构建 630版本的整体测试过程，详细叙述测试覆盖情况，并通过问题分析对版本整体质量进行评估和总结。


# 1   概述

统一构建平台是一个支持多种形式创建任务，简化多包构建，提升包构建效率，任务可追溯，支持重复构建，支持结果发布的一个构建系统。除此之外，该平台可针对不同用户设置不同的任务优先级，并为用户提供个性化、智能化的镜像定制与分层定制服务。该平台利用过载控制、资源监控等方式来防止任务大量堆积造成构建堵塞，进一步保证了服务质量以及构建效率。在此基础上，进一步扩展了镜像扩展能力，并提升构建效率，新增运维看板和手动bisect能力来加强问题定位能力。

本文主要描述统一构建 630版本的总体测试活动，按照社区开发模式进行运作，结合社区release-manager团队制定的版本计划规划相应的测试计划及活动。测试报告覆盖新需求测试执行情况和评估，并结合各类专项测试活动和版本问题单总体情况进行整体的说明和质量评估。

# 2   测试版本说明

1.统一构建 630版本新增单包及构建任务的执行效率提升、分层定制、构建任务优先级设置、软件包可重复构建、镜像定制、git-mirror服务效率提升、秘钥管理、用户贡献仓滚动更新发布场景建设、多用户队列、上传签名、过载控制、限流以及系统资源监控需求：


| 特性名称   | EBS-630-SDV1 | EBS-630-SDV2| EBS-630-SDV3 | EBS-630-SDV4 | EBS-630-SDV5  |EBS-630-SIT1 | EBS-630-SIT2   |
| ----------|   --------    |   --------    |   --------   |   --------   |    --------   |  ------- | ------- |
| 业务检测：监控执行机状态，job任务状态              | 2023-05-22    |  2023-05-26 | 2023-06-03 | 2023-06-10 | 2023-06-25 |   2023-07-15     |   2023-07-28    |
| 镜像扩展：镜像构建的通用环境         | /   | 2023-05-26 | 2023-06-03 | 2023-06-10 | 2023-06-25 |  2023-07-15   |   2023-07-28    |
| 镜像扩展：oemaker收编封装isocut功能              | /   | 2023-05-26 | 2023-06-03 | 2023-06-10 | 2023-06-25 |  2023-07-15   |  2023-07-28  |
| 镜像扩展：扩展支持qcow2，增强镜像定制能力          |  /   | 2023-05-26 | 2023-06-03 | 2023-06-10 | 2023-06-25 |  2023-07-15  |  2023-07-28  |
| 问题定位：手动bisect能力                         |  /   | 2023-05-26 | 2023-06-03 | 2023-06-10 | 2023-06-25 |  2023-07-15  |  2023-07-28   |
| 统一账号：接入社区统一账号                        |  /   | 2023-05-26 | 2023-06-03 | 2023-06-10 | 2023-06-25 |   2023-07-15  |   2023-07-28  |
| 用户体验：构建依赖关系可视化                     |  / | /  | 2023-06-03 | 2023-06-10 | 2023-06-25 |     2023-07-15    |    2023-07-28   |
| RadiaTest适配：提交任务合并submit-jobs及scheduled_tasks   | /   | /  | 2023-06-03 | 2023-06-10 | 2023-06-25 |   2023-07-15    | 2023-07-28   |
| 构建成功率提升：多project并行构建                 | /  | / | / |  2023-06-10 | 2023-06-25 |     2023-07-15       |   2023-07-28    |
| 构建成功率提升：squid多级缓存                |  /  | /  | / | 2023-06-10 |  2023-06-25 | 2023-07-15 |    2023-07-28      |          |
| 自动部署：一键自动化部署                     |  /  | /  | / | / | / | 2023-07-15|   2023-07-28     |        |
| 架构扩展：远程lab接入                        |  /  | /  | / | / | / | 2023-07-15   |   2023-07-28    |

测试的环境如下：

| 测试机                            | 配置信息                                                                          |个数| 备注                      |
| ----------------------------------- | ------------------------------------------------------------------------------------- | ------------------------- | ------------------------- |
| kubeoperator部署机| ARCH: arm<br />CPU: 8P<br />MEM: 15G<br />DISK_OS: 500G|1台|虚拟机|
| kubeoperator部署机| ARCH: x86<br />CPU: 8P<br />MEM: 15G<br />DISK_OS: 500G|1台|虚拟机|
| server01| ARCH: arm<br />CPU: 48P<br />MEM: 188G<br />DISK_OS: 500G|1台|虚拟机|
| server02| ARCH: arm<br />CPU: 48P<br />MEM: 96G<br />DISK_OS: 500G|1台|虚拟机|
| server03| ARCH: arm<br />CPU: 48P<br />MEM: 96G<br />DISK_OS: 500G|1台|虚拟机|
| test-at1| ARCH: arm<br />CPU: 48P<br />MEM: 96G<br />DISK_OS: 200G|1台|虚拟机|
| test-at2| ARCH: arm<br />CPU: 48P<br />MEM: 96G<br />DISK_OS: 500G|1台|虚拟机|
| test-at3| ARCH: arm<br />CPU: 48P<br />MEM: 96G<br />DISK_OS: 500G|1台|虚拟机|
| test-at4| ARCH: arm<br />CPU: 48P<br />MEM: 188G<br />DISK_OS: 200G|1台|虚拟机|
| test-xt1| ARCH: x86<br />CPU: 48P<br />MEM: 183G<br />DISK_OS: 500G|1台|虚拟机|
| test-xt2| ARCH: x86<br />CPU: 48P<br />MEM: 183G<br />DISK_OS: 500G|1台|虚拟机|
| test-xt3| ARCH: x86<br />CPU: 48P<br />MEM: 96G<br />DISK_OS: 200G|1台|虚拟机|
| test-xt4| ARCH: x86<br />CPU: 48P<br />MEM: 96G<br />DISK_OS: 200G|1台|虚拟机|
| test-xt5| ARCH: x86<br />CPU: 48P<br />MEM: 96G<br />DISK_OS: 200G|1台|虚拟机|
| test-xt6| ARCH: x86<br />CPU: 48P<br />MEM: 128G<br />DISK_OS: 500G|1台|虚拟机|
| test-xt7| ARCH: x86<br />CPU: 48P<br />MEM: 128G<br />DISK_OS: 500G|1台|虚拟机|
| test-xt8| ARCH: x86<br />CPU: 48P<br />MEM: 128G<br />DISK_OS: 500G|1台|虚拟机|

# 3   版本概要测试结论

 统一构建 630版本整体测试按照release-manager团队的计划，共完成了五轮模块测试+二轮回归测试；其中第一轮模块测试主要聚焦在新特性全量功能的验证以及平台web页面基础功能的测试；第二轮模块测试一方面针对新特性的功能进行全量测试，除此之外，对第一轮模块测试重点特性功能进行测试并验证第一轮模块测试的问题单验证和影响程度；第三、第四、第五轮模块测试，主要是针对问题单较多的模块进行全量测试，以及对现有的功能模块进行集成性的验证，验证问题单的修复情况以及是否因修复引入新的问题。第一轮回归测试对风险较大的模块进行重点覆盖和扩展测试，并针对新的需求进行模块化的测试。第二轮回归测试主要是针对前几轮遗留问题单进行回归验证，并对重点功能模块进行全量以及扩展测试，验证问题的修复和影响程度；旨在保证发布件和测试验证过程交付件的一致性。630版本按照测试策略完成了全量功能验证，所有测试任务均按计划完成。本版本计划交付SR需求5个，实际交付4个，交付率80%，其中，一键自动化部署需求中k8s安装部署未能实现自动化，部署周期较长，操作流程较复杂，因此，一键自动化部署需求验收评估不通过，其余的发布需求均验证通过。

​    统一构建 630版本共发现问题76个，有效问题70个，回归测试遗留结果正常。版本整体特性质量基本可用，部分问题转需求，无遗留问题。




# 4   版本详细测试结论

版本详细测试内容包括：

1、完成监控执行机状态、手动bisect能力、账号系统、一键自动化部署、远程lab接入、git-mirror服务效率提升、oemaker收编封装isocut能力、扩展支持qcow2镜像、构建依赖关系可视化、多project并行构建、squid多级源数据缓存、RadiaTest适配等特性的全量功能验证。




## 4.1   特性测试结论

### 4.1.1   新需求评价

建议以表格的形式汇总新特性测试执行情况及遗留问题单情况的评估,给出特性质量评估结论。

| **序号** | **特性名称**                                         | **测试覆盖情况**                                             | **约束依赖说明** | **遗留问题单** | **质量评估**               | **备注<img width=50/>**                                      |
| -------- | ---------------------------------------------------- | ------------------------------------------------------------ | ---------------- | -------------- | -------------------------- | ------------------------------------------------------------ |
| 1        |        监控执行机状态                              | 覆盖监控执行机模块查看权限，查看资源页面信息是否正确，查看业务覆盖单个筛选条件搜索，组合条件搜索，列表链接跳转，数据排序，按钮检查，共执行用例67条，整理质量良好 | NA               | NA             | <font color=green>█</font> |                                                             |
| 2        | 手动bisect能力                              | 覆盖脚本传参必填项，参数合法性检查，构造全量，增量构建失败点在最早，中间，最晚场景，验证bisect返回值是否正确，共执行19条用例，整体质量良好 | NA               | NA             | <font color=green>█</font>  |  |
|3| 账号系统 | 覆盖认证请求中参数值加密，access_token超时机制，数据库中字段保存及刷新，历史账号登录验证，共执行用例5条，整理质量良好 |NA|NA|<font color=green>█</font>  | |
| 4        | 一键自动化部署     | 覆盖检查统一构建服务是否运行在multi-docker的测试执行机上，检查被指定的服务是否运行在指定节点上，master节点服务挂掉后，请求是否跳转到worker节点，1个master宕机后，整个k8s不可用，请求无法跳转至其他worker节点，验证master到woker节点是否可免密登录，验证master到测试机是否可免密登录。共执行13条用例，提交需求单3个，k8s安装部署未实现自动化，搭建EBS需手动填写多个配置文件，优化EBS各个服务镜像构建任务编排，保证镜像构建有序进行，整体需求验收评估不通过 | NA               | NA             | <font color=red>●</font> |     该需求验收评估不通过过                                                         |
| 5        | 远程lab接入     | 覆盖是否可正常下载multidocker，配置服务端及账号信息；检查是否可正常执行multidocker；注册的执行机按照my_account维度归属，testbox表中为每一个testbox增加owner: account,表示测试机的所有者；检查启动multidocker后，执行机是否在队列中注册；通过前端下发执行任务，查看接入的执行机对应的队列中是否有任务；在执行机上查看是否有执行任务的docker容器；检查官方工程是否会下发到实验室接入的执行机上；执行机间隔x分钟获取任务检查；网络出现问题后，执行机请求任务异常场景验证；任务结束后，检查是否能够成功上传；手动终止multi-docker进程，检查是否自动注销，查看testbox表中一定时间后存储字段值是否变化，共执行用例12条，整体质量良好  | NA               | NA             | <font color=green>█</font> |                                                              |
| 6        | git-mirror服务效率提升                               | 覆盖有代码更新的仓库会拉取代码，没有代码更新的仓库不会有拉取代码的操作，同一个工程首次构建比第二次构建拉取代码时长缩短。共执行用例3条，整体质量良好| NA               | NA             | <font color=green>█</font> |                                                              |
| 7        |  oemaker收编封装isocut功能                           |  覆盖iso工具安装验证、镜像产物是否可用验证、工作目录内存容量满足与否验证、不同架构是否正常使用，验证生命周期内的LTS是否换标成功、图片非指定大小是否报错提示、背景图片大小正确性验证，是否支持容器进行裁剪等，共执行用例10条，整体质量良好      | NA               | NA             | <font color=green>█</font> |                                                              |
| 8        | 扩展支持qcow2镜像                            |    主要覆盖验证定制业务包页面各个输入框参数校验，验证定制业务包页面按钮功能校验；验证不添加软件包镜像能否构建成功，验证添加一个repo源中的部分软件包，镜像是否构建成功，验证添加多个不同repo中的软件包源镜像是否能够构建成功，验证添加数量比较多的软件包是否能够构建成功，验证添加软件包之后再移除软件包，构建成功后的镜像中软件包是否被移除，验证构建成功的镜像是否可以正常下载；验证构建成功的镜像格式是否正常；验证构建成功的镜像是否可以正常启动，并且包含添加的软件包；验证构建失败的场景，构建日志中的失败信息是否明确。共测试用例43个      | NA               | NA             | <font color=green>█</font> |                                                              |
| 9        |    构建依赖关系可视化                         | 覆盖增量和全量构建的构建详情页面展示、以及新增的DAG关系表页面信息检查、包括上下游依赖表清单、相关软件包的入度和出度数量、构建软件包的历史时长、构建状态、构建详情等、验证DAG图中的显示策略是否正确、包括每一次构建完后历史DAG关系图保留至前端展示，两个软件包之间节点流向表示软件包依赖关系，并验证构建时长的正确性，以及前端按钮的检查，共执行用例35条，无遗留问题，质量良好 | NA               | NA             | <font color=green>█</font> |                                                              |
| 10        |   多project并行构建                        |  环境上EMSX节点上服务和数据库部署是否正常；检查不同版本的es数据库和etcd数据库都在对应的EMSX上；检查每个扩展节点上，es数据库和etcd 数据库都在不同磁盘；验证new-repo只处理绑定project；验证点击projects页面上的“Go to repository”按钮,可以跳转到绑定EMSx节点的repository目录；验证ccache 使能的软件包构建时就近选则构建过的执行机进行构建；验证验证用户优先级 ci>admin>common；验证project优先级:ci>社区>个人；验证优先级高的用户任务优先执行；验证大包/支持ccache的软件包优先编译；验证版本优先级：开发>维护>其他；验证包类型优先级：单包>全量=增量；验证原来指定大包消费的机器也能消费其他小包；验证多个project 同时提交构建是否由串行编译改成并行编译并达到目标构建时长。共测试用例23个    | NA               | NA             | <font color=green>█</font> |
| 11       |    Squid多级缓存                         | 覆盖多级缓存squid使能检查、以及相应使能后规格是否达到要求、相关构建时长对比、缓存完整性验证、并检查squid开启后是否解决历史全量/增量构建失败问题，并检查删除机制是否会覆盖原有的缓存，共执行用例7条，无历史遗留问题，整体质量良好。 | NA               | NA             | <font color=green>█</font> |
| 12       |    RadiaTest适配             |  覆盖了对外接口功能入参校验以及每次触发提交是否显示实际提交人、触发radiatest构建任务，检查是否在submit_job日志中找到触发的job_id，验证触发全量、单包、增量构建软件包，检查是否在submit-job中找到触发的job_id，验证data-api接口是否能查询job，验证触发镜像构建，检查是否在submit_job日志中找到触发的job_id，共执行用例6条，整体质量良好   | NA               | NA             | <font color=green>█</font> |

<font color=red>●</font>： 表示特性不稳定，风险高

<font color=blue>▲</font>： 表示特性基本可用，遗留少量问题

<font color=green>█</font>： 表示特性质量良好



# 4   问题单统计

给出版本问题单的分布或分类统计及问题单走势分析。

统一构建 630版本共发现问题单76（不包含安全扫描问题）个，其中缺陷类问题单51个，需求类问题单19个，有效问题70个，其中修复缺陷问题单50个，采纳需求类问题单10个，未修复需求单9个，1个oemaker问题跟踪单，其余问题单回归均通过。详细分布见下表:

| 测试阶段     | 转测时间 | 发现问题 | 有效问题单数 | 无效问题单数 |需求问题单数|缺陷问题单数|
| :-: | :-:  | :-: | :-: | :-: |:-: |:-: |
| EBS-630-SDV1 | 0522-0526    | 11 | 9 | 2 | 3|6|
| EBS-630-SDV2 |  0529-0602  | 8 | 7 | 1 | 1|6|
| EBS-630-SDV3 | 0605-0609   | 11 | 10 | 1 |4|6|
| EBS-630-SDV4 | 0612-0626   | 23 | 21 | 2 | 4|17|
| EBS-630-SDV5 | 0707-0718   | 15 | 15 | 0 | 4|11|
| EBS-630-SIT1 | 0718-0722   | 4 | 4 | 0 |3|1|
| EBS-630-SIT2 | 0724-0728   | 4 | 4 | 0 |0|4|
|总计| \ | 76   | 70 | 6 | 19 | 51 |




# 5 附件

## 遗留问题列表
