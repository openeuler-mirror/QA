![avatar](../../images/openEuler.png)


版权所有 © 2023  openEuler社区
 您对“本文档”的复制、使用、修改及分发受知识共享(Creative Commons)署名—相同方式共享4.0国际公共许可协议(以下简称“CC BY-SA 4.0”)的约束。为了方便用户理解，您可以通过访问https://creativecommons.org/licenses/by-sa/4.0/ 了解CC BY-SA 4.0的概要 (但不是替代)。CC BY-SA 4.0的完整协议内容您可以访问如下网址获取：https://creativecommons.org/licenses/by-sa/4.0/legalcode。

修订记录

| 日期 | 修订   版本 | 修改描述 | 作者 |
| ---- | ----------- | -------- | ---- |
| 2021/01/24 |1.0.0  |KubeOS测试报告 | 何歆玥 |
|      |             |          |      |

关键词： KubeOS

摘要：


缩略语清单：

# 1     特性概述

在云场景下，容器和kubernetes的应用越来越广泛。因此需要针对这个场景专门设计一种新型的OS。因为业务都以容器的形式运行，OS只要支持kubernetes和容器运行时运行就行，不需要额外通过rpm安装包。OS整体升级，可以避免版本分裂等问题。裁剪不需要的包，可以使OS体积减小，升级时间缩短。通过k8s operator控制升级的流程，可以使得业务提前迁移到其他节点，OS升级不会影响业务。

# 2     特性测试信息

本节描述被测对象的版本信息和测试的时间及测试轮次，包括依赖的硬件。

| 版本名称 | 测试起始时间 | 测试结束时间 |
| -------- | ------------ | ------------ |
|openEuler 22.03-LTS SP1 update | 2024-01-18             |     2024-01-24         |
|          |              |              |


# 3     测试结论概述

## 3.1   测试整体结论

KubeOS特性，共计执行5个用例，主要覆盖了：

kbimg.sh裁剪脚本测试，包括虚拟机、容器镜像两种裁剪方式，覆盖功能测试；
os-agent升级测试，覆盖功能测试、异常配置测试，包括X86和ARM的虚拟机升级回退，包括disk方式和docker镜像方式的升级回退，包括跨内核版本升级回退；
综上，遗留风险小，整体质量良好。

## 3.2   约束说明

1. OS镜像制作
    1. 请确保已安装qemu-img，bc，parted，tar，yum，docker
    2. kbimg.sh 执行需要 root 权限
    3. 当前仅支持 X86和 AArch64 架构使用，X86架构仅支持 legacy 模式启动
    4. 制作镜像时提供的 repo 文件中，yum 源建议同时配置 openEuler 的 everything 仓库和 EPOL 仓库容器
    5. 容器镜像制作时不支持用户自定义配置挂载文件
    6. 制作 docker 镜像：
        1. 仅用于后续的虚拟机/物理机镜像制作或升级使用，不支持启动容器
        2. 使用默认 rpmlist 进行容器OS镜像制作时所需磁盘空间至少为6G，如自已定义 rpmlist 可能会超过6G
    7. 制作虚拟机镜像：
        1. 使用默认rpmlist进行容器OS镜像制作时所需磁盘空间至少为25G，如自已定义rpmlist可能会超过25G
    8. 制作物理机安装所需镜像和文件：
        1. 使用默认rpmlist进行镜像制作时所需磁盘空间至少为5G，如自已定义 rpmlist 可能会超过5G
        2. 不支持多个磁盘都安装KubeOS，可能会造成启动失败或挂载紊乱
2. 容器OS升级为所有软件包原子升级/回退，默认不在容器OS内提供单包升级/回退能力。
3. 容器OS升级为双区升级的方式，不支持更多分区数量。
4. 请严格按照提供的升级和回退流程进行操作，异常调用顺序可能会导致系统无法升级或回退。

## 3.3   遗留问题分析

### 3.3.1 遗留问题影响以及规避措施

不涉及

### 3.3.2 问题统计

|        | 问题总数 | 严重 | 主要 | 次要 | 不重要 |
| ------ | -------- | ---- | ---- | ---- | ------ |
| 数目   |4          |   0 |    4  |  0    |  0      |
| 百分比 | 100         | 0     | 100     |  0    |  0      |

# 4 详细测试结论

## 4.1 功能测试

覆盖裁剪、升级、回退等功能测试以及异常配置等负向功能测试；发现的问题都是日志显示类错误，没有接口异常和功能异常。

## 4.2 兼容性测试结论

重构前后的版本不兼容，不涉及

## 4.3 DFX专项测试结论

### 4.3.1 性能测试结论

os-proxy内存底噪为10.8M，os-agent内存底噪为1.5M，达成内存底噪优化预期目标

### 4.3.2 可靠性/韧性测试结论

覆盖升级异常掉电测试，未发现问题。

### 4.3.3 安全测试结论

覆盖文件权限等安全测试，未发现问题。

## 4.4 资料测试结论

继承资料，无新增修改。

## 4.5 其他测试结论

不涉及

# 5     测试执行

## 5.1   测试执行统计数据

*本节内容根据测试用例及实际执行情况进行特性整体测试的统计，可根据第二章的测试轮次分开进行统计说明。*

| 版本名称 | 测试用例数 | 用例执行结果 | 发现问题单数 |
| -------- | ---------- | ------------ | ------------ |
| openEuler 22.03-LTS SP1 update |  5  |  成功  |  4   |
|          |            |              |              |

*数据项说明：*

*测试用例数－－到本测试活动结束时，所有可用测试用例数；*

*发现问题单数－－本测试活动总共发现的问题单数。*

# 6 软件升级差异分析
| 差异分类    | 差异项                                                | 差异说明                                                     | 影响评估                                                     |
| :---------- | ----------------------------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 特性变化    | 新增特性/删除特性/变更特性实现                        | 用rust语言重写原有特性                                       | 对外功能无变化，对用户使用无影响                             |
| 配置文件    | 新增/变更/删除配置项                                  | 无变更                                                       | /                                                            |
| ABI差异     | 新增/变更/删除API                                     | 无变更                                                       | /                                                            |
|             | 新增/变更/删除结构体                                  | 无变更                                                       | /                                                            |
| 命令行/功能 | 新增/变更/删除命令                                    | 无变更                                                       | /                                                            |
|             | 新增/变更/删除命令选项                                | 无变更                                                       | /                                                            |
|             | 新增/变更/删除日志输出                                | 1.rust语言重写日志格式改变 2.os-agent增加升级时升级镜像写入备分区提醒日志 3.os-agent增加环境清理及清除内容提醒日志 | 对客户使用无影响，增加os-agent日志为客户提供更详细的流程提示 |
| SPEC文件    | 新增/变更/删除 编译依赖、安装依赖、依赖的软件版本变更 | 新增编译依赖：  rust cargo openssl-devel                     | 增加编译依赖进行rust语言二进制的编译，对用户使用无影响       |
|             | 拆分软件包方式变更                                    | 无变更                                                       | /                                                            |



 



 

 