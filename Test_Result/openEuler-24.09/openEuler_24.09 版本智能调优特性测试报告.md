



修订记录

| 日期       | 修订版本 | 修改  章节 | 修改描述 | 作者                                    |
| ---------- | -------- | ---------- | -------- | --------------------------------------- |
| 2024-07-05 | v1.0     |            | 初稿     | [@znzjugod](https://gitee.com/znzjugod) |

 关键词：

 openEuler EulerCopilot Tuning LLM AI

摘要：

智能调优原生Agent面向运维、开发人员，支持自然语言对接，实现启发式调优。共包括4个接口，分别为数据采集、系统负载分析、应用负载分析、推荐优化建议。本文主要叙述测试覆盖情况，并通过问题分析对该功能特性整体质量进行评估和总结。

缩略语清单：

| 缩略语 | 英文全名                | 中文解释   |
| ------ | ----------------------- | ---------- |
| OS     | Operating system        | 操作系统   |
| LLM    | Large Language Model    | 大语言模型 |
| Tuning | Tuning                  | 调优       |
| AI     | Artificial Intelligence | 人工智能   |
| Agent  | Agent                   | 代理       |

# 1     特性概述

智能调优原生Agent面向运维、开发人员，支持自然语言对接，实现启发式调优。共包括4个接口，分别为数据采集、系统负载分析、应用负载分析、推荐优化建议。其中：

- 数据采集接口实现采集系统/应用数据性能指标数据：采集cpu/network/disk/memory维度共30+指标；
- 系统负载分析接口实现系统负载分析：分析内容包含对cpu/disk/network/memory的性能分析，四类瓶颈点识别准确率大于70%；
- 应用负载分析接口实现应用负载分析（MySQL）：分析内容包含对MySQL的性能分析；
- 推荐优化建议接口实现推荐可执行的优化建议，在单节点具备生成优化建议（调整参数）的能力，推荐参数包括系统参数和应用参数共10+；

上述四个接口在EulerCopilot框架的调度下实现用户的性能优化相关的任务。


# 2     特性测试信息

智能调优原生Agent特性功能原则上在 openEuler-22.03-LTS-SP4 分支进行验证，本节描述被测对象的版本信息和测试的时间及测试轮次，包括相关硬件信息。

| 版本名称             | 测试起始时间 | 测试结束时间 |
| -------------------- | ------------ | ------------ |
| openEuler-24.09  RC3 | 2024-08-25   | 2024-08-29   |

描述特性测试的硬件环境信息
NestOS 在以下硬件进行安装适配和基本功能验证

| 硬件型号     | 硬件配置信息 | 备注       |
| ------------ | ------------ | ---------- |
| kunpeng 920B | 4u16g        | 虚拟机     |
| V100         | NA           | 英伟达显卡 |

# 3     测试结论概述

## 3.1   测试整体结论

智能调优原生Agent特性功能针对每个接口设计不同测试用例。基于压测工具stress对系统施加性能压力，其中：

CPU测试：

- 创建8个stress进程，持续时间600秒，模拟CPU在用户态使用率达到100%的场景。 stress --cpu 8 --timeout 600
- 创建多个dd进程持续读数据到null也可以达到对CPU进行压力测试。i=`cat /proc/cpuinfo |grep processor |wc -l` && seq $i|xargs -P $i -I {} bash -c 'echo 'CPU' {} 'running' && dd if=/dev/zero of=/dev/null'

内存测试：

- 创建5个进程，同时去malloc分配内存，并且保持100s后再释放内存。stress --vm 5 --vm-bytes 1G --vm-hang 100 --timeout 100s

磁盘IO：

- 创建两个写进程写入3G数据大小。stress --hdd 2 --hdd-bytes 3G --timeout 200
- 测试混合读写。fio -filename=test_file -direct=1 -iodepth 1 -thread -rw=rw -rwmixread=70 -ioengine=libaio -bs=4k -size=200m -numjobs=10 -runtime=60 -group_reporting -name=mytest

网络：

- 服务端运行： iperf -u -s ； -u表示以udp模式运行（不加该参数，默认是以tcp模式运行），-s表示作为服务端 

- 客户端运行： iperf -u -c 192.168.30.115 -b 100M -t 60 -i 2 ； 在udp模式下，以100Mbps为数据发送速率，客户端到服务器192.168.30.115上传带宽测试，测试时间为60秒

- 客户端运行： iperf -c 192.168.30.115 -u -i 1 -t 10 -b 2M -P 2 ；客户端同时向服务器端发起2个连接线程，每个连接线程以2Mbps为数据发送速率，测试时间为10秒

  经测试，在不同压力环境下，智能调优原生Agent特性功能：

  1. 数据采集接口可以正常采集数据指标30+，无问题；
  2. 系统负载分析接口对cpu/disk/network/memory的性能分析，四类瓶颈点识别准确率为87.5%；
  3. 应用负载分析接口可实现对MySQL的性能分析；

  4. 推荐优化建议接口可推荐系统参数和应用参数共10+；

  智能调优原生Agent特性功能共发现问题 0个，0个遗留问题，测试结果正常，版本整体质量较好。


## 3.2   特性测试结论
| 测试活动                         | 活动评价                                                     |
| -------------------------------- | ------------------------------------------------------------ |
| 四个接口功能测试                 | 实现四个接口预期功能                                         |
| EulerCopilot框架调用接口能力测试 | 已验证EulerCopilot框架可正常调用接口                         |
| 异常IP测试                       | 已验证仅支持用户配置的机器IP                                 |
| 推荐下一步优化举措测试           | 已验证EulerCopilot框架在智能调优场景可根据反馈自主推荐下一步优化举措 |

## 3.3   专项测试结论
| 测试活动     | 活动评价                                                     |
| ------------ | ------------------------------------------------------------ |
| 基础功能测试 | 对系统管理、系统服务、常用命令（文件系统、进程监控、网络、用户管理）进行测试，系统基础功能稳定。 |
| 安全性测试   | 对身份鉴别、安全审计、用户登录、用户权限、远程连接，测试结果符合预期。 |

## 3.4   约束说明

 - 内存：4GB及以上
 - 架构：x86_64、aarch64
 - 硬件：需具备服务器显卡


## 

## 3.5   遗留问题分析

### 3.6.1 遗留问题影响以及规避措施

不涉及

### 3.6.2 问题统计

暂无

# 4     测试执行

## 4.1   测试执行统计数据


| 版本名称                            | 测试用例数 | 用例执行结果     | 发现问题单数 |
| ----------------------------------- | ---------- | ---------------- | ------------ |
| openEuler 22.03 LTS SP4 RC3 ARM+X86 | 35         | 28 PASS + 7 FAIL | 当前FAILCASE,主要是框架侧LLM给接口传入正确参数能力暂时还不足，属于技术难点，还在逐步提升中，非问题。在调用接口
    失败后，会返回给用户报错信息，不影响用户使用。            |

## 4.2   后续测试建议

后续测试需要关注点

1. 关注数据采集底噪对系统性能影响；
2. 关注整体智能调优Agent的运行时长

# 5     附件

*此处可粘贴各类专项测试数据或报告*
